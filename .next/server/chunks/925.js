"use strict";exports.id=925,exports.ids=[925],exports.modules={43895:(e,r,t)=>{t.d(r,{k:()=>d});var i=t(94624),s=t.n(i),n=t(92048),o=t(55315);let a=process.env.LOG_FILE||(0,o.join)(process.cwd(),"data","bot.log"),l=process.env.LOG_LEVEL||"info",c=(0,o.dirname)(a);(0,n.existsSync)(c)||(0,n.mkdirSync)(c,{recursive:!0});let d=s().createLogger({level:l,format:s().format.combine(s().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),s().format.printf(({timestamp:e,level:r,message:t,...i})=>{let s=Object.keys(i).length?` ${JSON.stringify(i)}`:"";return`[${e}] ${r.toUpperCase()}: ${t}${s}`})),transports:[new(s()).transports.Console({format:s().format.combine(s().format.colorize(),s().format.timestamp({format:"HH:mm:ss"}),s().format.printf(({timestamp:e,level:r,message:t})=>`[${e}] ${r}: ${t}`))}),new(s()).transports.File({filename:a,maxsize:10485760,maxFiles:5})]})},21925:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.d(r,{EG:()=>m,L4:()=>S,SX:()=>k,YX:()=>p,_e:()=>E,pQ:()=>A,tS:()=>f});var s=t(67332),n=t(47152),o=t(90399),a=t(99648),l=t(35240),c=t.n(l),d=t(43895),u=e([s,a]);[s,a]=u.then?(await u)():u;let C=new(c()).Agent({ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",keepAlive:!0});a.default.interceptors.request.use(e=>(e.headers["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36",e.headers.Accept="application/json, text/plain, */*",e.headers["Accept-Language"]="en-US,en;q=0.9",e.headers.Connection="keep-alive",e.httpAgent=e.httpAgent||C,e.httpsAgent=e.httpsAgent||C,e.timeout=e.timeout||5e3,e));let g=null,$=null,F=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com";async function f(){if(g)return g;let e=process.env.PRIVATE_KEY,r=process.env.FUNDER_ADDRESS,t=process.env.CLOB_API_URL||"https://clob.polymarket.com",i=parseInt(process.env.CHAIN_ID||"137"),a=parseInt(process.env.SIGNATURE_TYPE||"0");if(!e||!r)return d.k.warn("No PRIVATE_KEY or FUNDER_ADDRESS set — live trading unavailable"),null;try{let l=new o.StaticJsonRpcProvider(F,137),c=new n.Wallet(e,l),u=process.env.CLOB_API_KEY,f=process.env.CLOB_SECRET,p=process.env.CLOB_PASSPHRASE;if(u&&f&&p)$={key:u,secret:f,passphrase:p},d.k.info("Using pre-configured CLOB API keys from .env");else{let e=new s.ClobClient(t,i,c,void 0,a,r);$=await e.createOrDeriveApiKey(),d.k.info("API keys derived from Polymarket")}return g=new s.ClobClient(t,i,c,$,a,r),d.k.info("CLOB client initialized successfully"),g}catch(e){return d.k.error(`Failed to initialize CLOB client: ${e}`),null}}function p(){let e=process.env.CLOB_API_URL||"https://clob.polymarket.com",r=parseInt(process.env.CHAIN_ID||"137");return new s.ClobClient(e,r)}async function S(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{d.k.info(`[FOK] Placing BUY: $${t} on token=${e.slice(0,10)}...`);let a=await o.createAndPostMarketOrder({tokenID:e,amount:t,side:s.Side.BUY,feeRateBps:void 0,nonce:void 0},{tickSize:i,negRisk:n},s.OrderType.FOK);d.k.info(`[FOK] BUY response: ${JSON.stringify(a)}`);let l=a?.orderID||a?.orderIds?.[0];if(!l||"unknown"===l)return d.k.error(`Buy FOK returned no orderId — order not accepted`),{success:!1,error:"No orderId returned from Polymarket"};let c=await O(o,l,e,"BUY");if(!c.filled)return d.k.warn(`Buy FOK ${l} — no fill confirmed (${c.method}): ${c.status}`),{success:!1,error:`Order not filled (${c.status})`,orderId:l};return d.k.info(`Buy FOK FILLED: ${c.sizeFilled.toFixed(4)} shares @ $${c.avgPrice.toFixed(4)} | verified via ${c.method} | token=${e.slice(0,10)}...`),{success:!0,orderId:l,filledSize:c.sizeFilled,filledPrice:c.avgPrice||r}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`Buy FOK failed: ${e}`),{success:!1,error:e}}}async function m(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{d.k.info(`[FOK] Placing SELL: ${t.toFixed(4)} shares on token=${e.slice(0,10)}...`);let a=await o.createAndPostMarketOrder({tokenID:e,amount:t,side:s.Side.SELL,feeRateBps:void 0,nonce:void 0},{tickSize:i,negRisk:n},s.OrderType.FOK);d.k.info(`[FOK] SELL response: ${JSON.stringify(a)}`);let l=a?.orderID||a?.orderIds?.[0];if(!l||"unknown"===l)return d.k.error(`Sell FOK returned no orderId — order not accepted`),{success:!1,error:"No orderId returned from Polymarket"};let c=await O(o,l,e,"SELL");if(!c.filled)return d.k.warn(`Sell FOK ${l} — no fill confirmed (${c.method}): ${c.status}`),{success:!1,error:`Order not filled (${c.status})`,orderId:l};return d.k.info(`Sell FOK FILLED: ${c.sizeFilled.toFixed(4)} shares @ $${c.avgPrice.toFixed(4)} | verified via ${c.method} | token=${e.slice(0,10)}...`),{success:!0,orderId:l,filledSize:c.sizeFilled,filledPrice:c.avgPrice||r}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`Sell FOK failed: ${e}`),{success:!1,error:e}}}async function A(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=await o.createAndPostOrder({tokenID:e,price:r,side:s.Side.BUY,size:t,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n},s.OrderType.GTC,!1,!0);return d.k.info(`[ARB] Limit buy placed: ${t.toFixed(2)} shares @ $${r} | token=${e}`),{success:!0,orderId:a?.orderID||a?.orderIds?.[0]||"unknown"}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`[ARB] Limit buy failed: ${e}`),{success:!1,error:e}}}async function E(e){let r=await f();if(!r)return{success:!1,error:"CLOB client not initialized"};try{return await r.cancelOrders(e),d.k.info(`[ARB] Cancelled ${e.length} orders`),{success:!0}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`[ARB] Batch cancel failed: ${e}`),{success:!1,error:e}}}async function k(e){let r=await f();if(!r)return null;try{let t=await r.getOrder(e);if(!t)return null;let i=parseFloat(t.size_matched||"0");parseFloat(t.original_size||"0");let s=parseFloat(t.price||"0"),n=t.status||"unknown";return{filled:i>0,sizeFilled:i,sizeMatched:i,status:n,price:s}}catch(r){return d.k.error(`Failed to get order status for ${e}: ${r}`),null}}async function O(e,r,t,i){await new Promise(e=>setTimeout(e,300));try{let i=await e.getTrades({asset_id:t},!0);if(i&&i.length>0){let e=i.find(e=>e.taker_order_id===r||e.order_id===r);if(e){let r=parseFloat(e.size||"0"),t=parseFloat(e.price||"0");if(r>0)return{filled:!0,sizeFilled:r,avgPrice:t,status:"MATCHED",method:"getTrades"}}let t=i[0],s=t.match_time?new Date(t.match_time).getTime():0,n=Date.now();if(n-s<5e3){let e=parseFloat(t.size||"0"),r=parseFloat(t.price||"0");if(e>0&&"TAKER"===t.trader_side)return d.k.info(`[FOK] Matched recent taker trade: ${e} shares @ $${r} (${n-s}ms ago)`),{filled:!0,sizeFilled:e,avgPrice:r,status:"MATCHED",method:"getTrades-recent"}}}}catch(e){d.k.warn(`[FOK] getTrades lookup failed: ${e}`)}try{let t=await e.getOrder(r);if(t){let e=parseFloat(t.size_matched||"0"),r=parseFloat(t.price||"0"),i=(t.status||"").toUpperCase();if(d.k.info(`[FOK] getOrder result: status=${i} matched=${e} price=${r}`),e>0)return{filled:!0,sizeFilled:e,avgPrice:r,status:t.status,method:"getOrder"};if("MATCHED"===i||"CLOSED"===i||"FILLED"===i)return{filled:!0,sizeFilled:e||0,avgPrice:r,status:t.status,method:"getOrder-status"};return{filled:!1,sizeFilled:0,avgPrice:0,status:t.status||"unknown",method:"getOrder"}}}catch(e){d.k.warn(`[FOK] getOrder lookup failed for ${r}: ${e}`)}return{filled:!1,sizeFilled:0,avgPrice:0,status:"unverifiable",method:"none"}}i()}catch(e){i(e)}})}};