"use strict";exports.id=925,exports.ids=[925],exports.modules={43895:(e,r,t)=>{t.d(r,{k:()=>d});var i=t(94624),s=t.n(i),n=t(92048),o=t(55315);let a=process.env.LOG_FILE||(0,o.join)(process.cwd(),"data","bot.log"),l=process.env.LOG_LEVEL||"info",c=(0,o.dirname)(a);(0,n.existsSync)(c)||(0,n.mkdirSync)(c,{recursive:!0});let d=s().createLogger({level:l,format:s().format.combine(s().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),s().format.printf(({timestamp:e,level:r,message:t,...i})=>{let s=Object.keys(i).length?` ${JSON.stringify(i)}`:"";return`[${e}] ${r.toUpperCase()}: ${t}${s}`})),transports:[new(s()).transports.Console({format:s().format.combine(s().format.colorize(),s().format.timestamp({format:"HH:mm:ss"}),s().format.printf(({timestamp:e,level:r,message:t})=>`[${e}] ${r}: ${t}`))}),new(s()).transports.File({filename:a,maxsize:10485760,maxFiles:5})]})},21925:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.d(r,{EG:()=>A,L4:()=>p,SX:()=>m,YX:()=>S,_e:()=>C,pQ:()=>E,tS:()=>f});var s=t(67332),n=t(47152),o=t(90399),a=t(99648),l=t(35240),c=t.n(l),d=t(43895),u=e([s,a]);[s,a]=u.then?(await u)():u;let v=new(c()).Agent({ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",keepAlive:!0});a.default.interceptors.request.use(e=>(e.headers["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36",e.headers.Accept="application/json, text/plain, */*",e.headers["Accept-Language"]="en-US,en;q=0.9",e.headers.Connection="keep-alive",e.httpAgent=e.httpAgent||v,e.httpsAgent=e.httpsAgent||v,e.timeout=e.timeout||5e3,e));let L=null,w=null,y=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com";async function f(){if(L)return L;let e=process.env.PRIVATE_KEY,r=process.env.FUNDER_ADDRESS,t=process.env.CLOB_API_URL||"https://clob.polymarket.com",i=parseInt(process.env.CHAIN_ID||"137"),a=parseInt(process.env.SIGNATURE_TYPE||"0");if(!e||!r)return d.k.warn("No PRIVATE_KEY or FUNDER_ADDRESS set — live trading unavailable"),null;try{let l=new o.StaticJsonRpcProvider(y,137),c=new n.Wallet(e,l),u=process.env.CLOB_API_KEY,f=process.env.CLOB_SECRET,S=process.env.CLOB_PASSPHRASE;if(u&&f&&S)w={key:u,secret:f,passphrase:S},d.k.info("Using pre-configured CLOB API keys from .env");else{let e=new s.ClobClient(t,i,c,void 0,a,r);w=await e.createOrDeriveApiKey(),d.k.info("API keys derived from Polymarket")}return L=new s.ClobClient(t,i,c,w,a,r),d.k.info("CLOB client initialized successfully"),L}catch(e){return d.k.error(`Failed to initialize CLOB client: ${e}`),null}}function S(){let e=process.env.CLOB_API_URL||"https://clob.polymarket.com",r=parseInt(process.env.CHAIN_ID||"137");return new s.ClobClient(e,r)}async function p(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=await o.createAndPostOrder({tokenID:e,price:r,side:s.Side.BUY,size:t,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n}),l=a?.orderID||a?.orderIds?.[0];if(!l||"unknown"===l)return d.k.error(`Buy order returned no valid orderId — order may not have been accepted`),{success:!1,error:"No orderId returned from Polymarket"};let c=await k(l,8e3,500);if(!c.filled||c.sizeFilled<=0)return d.k.warn(`Buy order ${l} was NOT filled (status: ${c.status}) — no trade recorded`),{success:!1,error:`Order not filled (status: ${c.status})`,orderId:l};return d.k.info(`Buy order FILLED: ${c.sizeFilled.toFixed(4)} shares @ $${r} | status=${c.status} | token=${e}`),{success:!0,orderId:l,filledSize:c.sizeFilled,filledPrice:c.avgPrice||r}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`Buy order failed: ${e}`),{success:!1,error:e}}}async function A(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=await o.createAndPostOrder({tokenID:e,price:r,side:s.Side.SELL,size:t,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n}),l=a?.orderID||a?.orderIds?.[0];if(!l||"unknown"===l)return d.k.error(`Sell order returned no valid orderId — order may not have been accepted`),{success:!1,error:"No orderId returned from Polymarket"};let c=await k(l,8e3,500);if(!c.filled||c.sizeFilled<=0)return d.k.warn(`Sell order ${l} was NOT filled (status: ${c.status}) — no trade recorded`),{success:!1,error:`Order not filled (status: ${c.status})`,orderId:l};return d.k.info(`Sell order FILLED: ${c.sizeFilled.toFixed(4)} shares @ $${r} | status=${c.status} | token=${e}`),{success:!0,orderId:l,filledSize:c.sizeFilled,filledPrice:c.avgPrice||r}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`Sell order failed: ${e}`),{success:!1,error:e}}}async function E(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=await o.createAndPostOrder({tokenID:e,price:r,side:s.Side.BUY,size:t,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n},s.OrderType.GTC,!1,!0);return d.k.info(`[ARB] Limit buy placed: ${t.toFixed(2)} shares @ $${r} | token=${e}`),{success:!0,orderId:a?.orderID||a?.orderIds?.[0]||"unknown"}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`[ARB] Limit buy failed: ${e}`),{success:!1,error:e}}}async function C(e){let r=await f();if(!r)return{success:!1,error:"CLOB client not initialized"};try{return await r.cancelOrders(e),d.k.info(`[ARB] Cancelled ${e.length} orders`),{success:!0}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`[ARB] Batch cancel failed: ${e}`),{success:!1,error:e}}}async function m(e){let r=await f();if(!r)return null;try{let t=await r.getOrder(e);if(!t)return null;let i=parseFloat(t.size_matched||"0");parseFloat(t.original_size||"0");let s=parseFloat(t.price||"0"),n=t.status||"unknown";return{filled:i>0,sizeFilled:i,sizeMatched:i,status:n,price:s}}catch(r){return d.k.error(`Failed to get order status for ${e}: ${r}`),null}}async function k(e,r=5e3,t=500){let i=Date.now(),s=null;for(;Date.now()-i<r;){if(!(s=await m(e))){await new Promise(e=>setTimeout(e,t));continue}let r=s.status.toUpperCase();if("MATCHED"===r||"CLOSED"===r||"FILLED"===r)return{filled:s.sizeFilled>0,sizeFilled:s.sizeFilled,avgPrice:s.price,status:s.status};if("CANCELLED"===r||"EXPIRED"===r||"REJECTED"===r)return{filled:!1,sizeFilled:0,avgPrice:0,status:s.status};s.sizeFilled,await new Promise(e=>setTimeout(e,t))}return{filled:!!s&&s.sizeFilled>0,sizeFilled:s?.sizeFilled||0,avgPrice:s?.price||0,status:s?.status||"timeout"}}i()}catch(e){i(e)}})}};