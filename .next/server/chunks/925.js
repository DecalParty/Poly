"use strict";exports.id=925,exports.ids=[925],exports.modules={43895:(e,t,r)=>{r.d(t,{k:()=>d});var i=r(94624),s=r.n(i),n=r(92048),o=r(55315);let a=process.env.LOG_FILE||(0,o.join)(process.cwd(),"data","bot.log"),l=process.env.LOG_LEVEL||"info",c=(0,o.dirname)(a);(0,n.existsSync)(c)||(0,n.mkdirSync)(c,{recursive:!0});let d=s().createLogger({level:l,format:s().format.combine(s().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),s().format.printf(({timestamp:e,level:t,message:r,...i})=>{let s=Object.keys(i).length?` ${JSON.stringify(i)}`:"";return`[${e}] ${t.toUpperCase()}: ${r}${s}`})),transports:[new(s()).transports.Console({format:s().format.combine(s().format.colorize(),s().format.timestamp({format:"HH:mm:ss"}),s().format.printf(({timestamp:e,level:t,message:r})=>`[${e}] ${t}: ${r}`))}),new(s()).transports.File({filename:a,maxsize:10485760,maxFiles:5})]})},21925:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{EG:()=>E,L4:()=>S,SX:()=>C,YX:()=>p,_e:()=>m,fA:()=>w,pQ:()=>A,tS:()=>f});var s=r(67332),n=r(47152),o=r(90399),a=r(99648),l=r(35240),c=r.n(l),d=r(43895),u=e([s,a]);[s,a]=u.then?(await u)():u;let v=new(c()).Agent({ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",keepAlive:!0});a.default.interceptors.request.use(e=>(e.headers["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36",e.headers.Accept="application/json, text/plain, */*",e.headers["Accept-Language"]="en-US,en;q=0.9",e.headers.Connection="keep-alive",e.httpAgent=e.httpAgent||v,e.httpsAgent=e.httpsAgent||v,e.timeout=e.timeout||5e3,e));let L=null,$=null,g=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com";async function f(){if(L)return L;let e=process.env.PRIVATE_KEY,t=process.env.FUNDER_ADDRESS,r=process.env.CLOB_API_URL||"https://clob.polymarket.com",i=parseInt(process.env.CHAIN_ID||"137"),a=parseInt(process.env.SIGNATURE_TYPE||"2");if(!e||!t)return d.k.warn("No PRIVATE_KEY or FUNDER_ADDRESS set â€” live trading unavailable"),null;try{let l=new o.StaticJsonRpcProvider(g,137),c=new n.Wallet(e,l),u=process.env.CLOB_API_KEY,f=process.env.CLOB_SECRET,p=process.env.CLOB_PASSPHRASE;if(u&&f&&p)$={key:u,secret:f,passphrase:p},d.k.info("Using pre-configured CLOB API keys from .env");else{let e=new s.ClobClient(r,i,c,void 0,a,t);$=await e.createOrDeriveApiKey(),d.k.info("API keys derived from Polymarket")}return L=new s.ClobClient(r,i,c,$,a,t),d.k.info("CLOB client initialized successfully"),L}catch(e){return d.k.error(`Failed to initialize CLOB client: ${e}`),null}}function p(){let e=process.env.CLOB_API_URL||"https://clob.polymarket.com",t=parseInt(process.env.CHAIN_ID||"137");return new s.ClobClient(e,t)}async function S(e,t,r,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=parseFloat(i)||.01,l=Math.min(.99,Math.round((t+.01)/a)*a);d.k.info(`[LIVE] BUY: ${r.toFixed(4)} shares @ $${l.toFixed(4)} (mid=$${t.toFixed(4)}) | token=${e.slice(0,10)}...`);let c=await o.createAndPostOrder({tokenID:e,price:l,side:s.Side.BUY,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n});d.k.info(`[LIVE] BUY response: ${JSON.stringify(c)}`);let u=c?.orderID||c?.orderIds?.[0];if(!u||"unknown"===u)return d.k.error("Buy order returned no orderId"),{success:!1,error:"No orderId returned from Polymarket"};let f=await k(u,8e3,500);if(!f.filled||f.sizeFilled<=0)return d.k.warn(`Buy order ${u} NOT filled (status: ${f.status})`),{success:!1,error:`Order not filled (status: ${f.status})`,orderId:u};return d.k.info(`Buy FILLED: ${f.sizeFilled.toFixed(4)} shares @ $${f.avgPrice.toFixed(4)} | token=${e.slice(0,10)}...`),{success:!0,orderId:u,filledSize:f.sizeFilled,filledPrice:f.avgPrice||l}}catch(t){let e=t instanceof Error?t.message:String(t);return d.k.error(`Buy order failed: ${e}`),{success:!1,error:e}}}async function E(e,t,r,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=parseFloat(i)||.01,l=Math.max(.01,Math.round((t-.01)/a)*a);d.k.info(`[LIVE] SELL: ${r.toFixed(4)} shares @ $${l.toFixed(4)} (mid=$${t.toFixed(4)}) | token=${e.slice(0,10)}...`);let c=await o.createAndPostOrder({tokenID:e,price:l,side:s.Side.SELL,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n});d.k.info(`[LIVE] SELL response: ${JSON.stringify(c)}`);let u=c?.orderID||c?.orderIds?.[0];if(!u||"unknown"===u)return d.k.error("Sell order returned no orderId"),{success:!1,error:"No orderId returned from Polymarket"};let f=await k(u,8e3,500);if(!f.filled||f.sizeFilled<=0)return d.k.warn(`Sell order ${u} NOT filled (status: ${f.status})`),{success:!1,error:`Order not filled (status: ${f.status})`,orderId:u};return d.k.info(`Sell FILLED: ${f.sizeFilled.toFixed(4)} shares @ $${f.avgPrice.toFixed(4)} | token=${e.slice(0,10)}...`),{success:!0,orderId:u,filledSize:f.sizeFilled,filledPrice:f.avgPrice||l}}catch(t){let e=t instanceof Error?t.message:String(t);return d.k.error(`Sell order failed: ${e}`),{success:!1,error:e}}}async function A(e,t,r,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=await o.createAndPostOrder({tokenID:e,price:t,side:s.Side.BUY,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n},s.OrderType.GTC,!1,!0);return d.k.info(`[ARB] Limit buy placed: ${r.toFixed(2)} shares @ $${t} | token=${e}`),{success:!0,orderId:a?.orderID||a?.orderIds?.[0]||"unknown"}}catch(t){let e=t instanceof Error?t.message:String(t);return d.k.error(`[ARB] Limit buy failed: ${e}`),{success:!1,error:e}}}async function m(e){let t=await f();if(!t)return{success:!1,error:"CLOB client not initialized"};try{return await t.cancelOrders(e),d.k.info(`[ARB] Cancelled ${e.length} orders`),{success:!0}}catch(t){let e=t instanceof Error?t.message:String(t);return d.k.error(`[ARB] Batch cancel failed: ${e}`),{success:!1,error:e}}}async function C(e){let t=await f();if(!t)return null;try{let r=await t.getOrder(e);if(!r)return null;let i=parseFloat(r.size_matched||"0");parseFloat(r.original_size||"0");let s=parseFloat(r.price||"0"),n=r.status||"unknown";return{filled:i>0,sizeFilled:i,sizeMatched:i,status:n,price:s}}catch(t){return d.k.error(`Failed to get order status for ${e}: ${t}`),null}}async function k(e,t=5e3,r=500){let i=Date.now(),s=null;for(;Date.now()-i<t;){if(!(s=await C(e))){await new Promise(e=>setTimeout(e,r));continue}let t=s.status.toUpperCase();if("MATCHED"===t||"CLOSED"===t||"FILLED"===t)return{filled:s.sizeFilled>0,sizeFilled:s.sizeFilled,avgPrice:s.price,status:s.status};if("CANCELLED"===t||"EXPIRED"===t||"REJECTED"===t)return{filled:!1,sizeFilled:0,avgPrice:0,status:s.status};s.sizeFilled,await new Promise(e=>setTimeout(e,r))}return{filled:!!s&&s.sizeFilled>0,sizeFilled:s?.sizeFilled||0,avgPrice:s?.price||0,status:s?.status||"timeout"}}let y="0x4D97DCd97eC945f40cF65F87097ACe5EA0476045",D=["function redeemPositions(address collateralToken, bytes32 parentCollectionId, bytes32 conditionId, uint256[] indexSets)","function balanceOf(address owner, uint256 id) view returns (uint256)"],F=["function redeemPositions(bytes32 conditionId, uint256[] amounts)"],P=["function execTransaction(address to, uint256 value, bytes data, uint8 operation, uint256 safeTxGas, uint256 baseGas, uint256 gasPrice, address gasToken, address refundReceiver, bytes signatures) payable returns (bool)","function getTransactionHash(address to, uint256 value, bytes data, uint8 operation, uint256 safeTxGas, uint256 baseGas, uint256 gasPrice, address gasToken, address refundReceiver, uint256 _nonce) view returns (bytes32)","function nonce() view returns (uint256)"];async function w(e,t){let i=process.env.PRIVATE_KEY,s=process.env.FUNDER_ADDRESS;if(!i||!s)return{success:!1,error:"No PRIVATE_KEY or FUNDER_ADDRESS"};try{let a,l;let c=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",u=new o.StaticJsonRpcProvider(c,137),f=new n.Wallet(i,u),{Contract:p}=await Promise.resolve().then(r.t.bind(r,12792,23)),{Interface:S}=await Promise.all([r.e(805),r.e(267)]).then(r.bind(r,63267)),{arrayify:E,hexlify:A}=await r.e(805).then(r.bind(r,91805)),m="0x0000000000000000000000000000000000000000",C=[1,2],k=new p(y,D,u),w=!1;for(let t of C)try{let r=BigInt(e)+BigInt(t),i=await k.balanceOf(s,r);if(Number(i)>0){w=!0;break}}catch{w=!0;break}if(!w)return d.k.info(`[Redeem] No tokens at proxy wallet for ${e.slice(0,10)}...`),{success:!0};t?(l=new S(F).encodeFunctionData("redeemPositions",[e,C]),a="0xd91E80cF2E7be2e162c6513ceD06f1dD0dA35296"):(l=new S(D).encodeFunctionData("redeemPositions",["0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174","0x0000000000000000000000000000000000000000000000000000000000000000",e,C]),a=y);let v=new p(s,P,f),L=await v.nonce(),$=await v.getTransactionHash(a,0,l,0,0,0,0,m,m,L),g=await f.signMessage(E($)),h=E(g);h[64]+=4;let I=A(h),R=await v.execTransaction(a,0,l,0,0,0,0,m,m,I);return await R.wait(),d.k.info(`[Redeem] Claimed via Safe tx: ${R.hash} | conditionId=${e.slice(0,10)}...`),{success:!0}}catch(r){let t=r instanceof Error?r.message:String(r);return d.k.error(`[Redeem] Failed for ${e.slice(0,10)}...: ${t}`),{success:!1,error:t}}}i()}catch(e){i(e)}})}};