"use strict";exports.id=925,exports.ids=[925],exports.modules={43895:(e,r,t)=>{t.d(r,{k:()=>d});var i=t(94624),s=t.n(i),n=t(92048),o=t(55315);let a=process.env.LOG_FILE||(0,o.join)(process.cwd(),"data","bot.log"),l=process.env.LOG_LEVEL||"info",c=(0,o.dirname)(a);(0,n.existsSync)(c)||(0,n.mkdirSync)(c,{recursive:!0});let d=s().createLogger({level:l,format:s().format.combine(s().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),s().format.printf(({timestamp:e,level:r,message:t,...i})=>{let s=Object.keys(i).length?` ${JSON.stringify(i)}`:"";return`[${e}] ${r.toUpperCase()}: ${t}${s}`})),transports:[new(s()).transports.Console({format:s().format.combine(s().format.colorize(),s().format.timestamp({format:"HH:mm:ss"}),s().format.printf(({timestamp:e,level:r,message:t})=>`[${e}] ${r}: ${t}`))}),new(s()).transports.File({filename:a,maxsize:10485760,maxFiles:5})]})},21925:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.d(r,{EG:()=>A,L4:()=>S,SX:()=>C,YX:()=>p,_e:()=>m,fA:()=>L,pQ:()=>E,tS:()=>f});var s=t(67332),n=t(47152),o=t(90399),a=t(99648),l=t(35240),c=t.n(l),d=t(43895),u=e([s,a]);[s,a]=u.then?(await u)():u;let w=new(c()).Agent({ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",keepAlive:!0});a.default.interceptors.request.use(e=>(e.headers["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36",e.headers.Accept="application/json, text/plain, */*",e.headers["Accept-Language"]="en-US,en;q=0.9",e.headers.Connection="keep-alive",e.httpAgent=e.httpAgent||w,e.httpsAgent=e.httpsAgent||w,e.timeout=e.timeout||5e3,e));let $=null,v=null,y=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com";async function f(){if($)return $;let e=process.env.PRIVATE_KEY,r=process.env.FUNDER_ADDRESS,t=process.env.CLOB_API_URL||"https://clob.polymarket.com",i=parseInt(process.env.CHAIN_ID||"137"),a=parseInt(process.env.SIGNATURE_TYPE||"2");if(!e||!r)return d.k.warn("No PRIVATE_KEY or FUNDER_ADDRESS set â€” live trading unavailable"),null;try{let l=new o.StaticJsonRpcProvider(y,137),c=new n.Wallet(e,l),u=process.env.CLOB_API_KEY,f=process.env.CLOB_SECRET,p=process.env.CLOB_PASSPHRASE;if(u&&f&&p)v={key:u,secret:f,passphrase:p},d.k.info("Using pre-configured CLOB API keys from .env");else{let e=new s.ClobClient(t,i,c,void 0,a,r);v=await e.createOrDeriveApiKey(),d.k.info("API keys derived from Polymarket")}return $=new s.ClobClient(t,i,c,v,a,r),d.k.info("CLOB client initialized successfully"),$}catch(e){return d.k.error(`Failed to initialize CLOB client: ${e}`),null}}function p(){let e=process.env.CLOB_API_URL||"https://clob.polymarket.com",r=parseInt(process.env.CHAIN_ID||"137");return new s.ClobClient(e,r)}async function S(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=parseFloat(i)||.01,l=Math.min(.99,Math.round((r+.02)/a)*a);d.k.info(`[LIVE] BUY: ${t.toFixed(4)} shares @ $${l.toFixed(4)} (mid=$${r.toFixed(4)}) | token=${e.slice(0,10)}...`);let c=await o.createAndPostOrder({tokenID:e,price:l,side:s.Side.BUY,size:t,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n});d.k.info(`[LIVE] BUY response: ${JSON.stringify(c)}`);let u=c?.orderID||c?.orderIds?.[0];if(!u||"unknown"===u)return d.k.error("Buy order returned no orderId"),{success:!1,error:"No orderId returned from Polymarket"};let f=await k(u,8e3,500);if(!f.filled||f.sizeFilled<=0)return d.k.warn(`Buy order ${u} NOT filled (status: ${f.status})`),{success:!1,error:`Order not filled (status: ${f.status})`,orderId:u};return d.k.info(`Buy FILLED: ${f.sizeFilled.toFixed(4)} shares @ $${f.avgPrice.toFixed(4)} | token=${e.slice(0,10)}...`),{success:!0,orderId:u,filledSize:f.sizeFilled,filledPrice:f.avgPrice||l}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`Buy order failed: ${e}`),{success:!1,error:e}}}async function A(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=parseFloat(i)||.01,l=Math.max(.01,Math.round((r-.02)/a)*a);d.k.info(`[LIVE] SELL: ${t.toFixed(4)} shares @ $${l.toFixed(4)} (mid=$${r.toFixed(4)}) | token=${e.slice(0,10)}...`);let c=await o.createAndPostOrder({tokenID:e,price:l,side:s.Side.SELL,size:t,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n});d.k.info(`[LIVE] SELL response: ${JSON.stringify(c)}`);let u=c?.orderID||c?.orderIds?.[0];if(!u||"unknown"===u)return d.k.error("Sell order returned no orderId"),{success:!1,error:"No orderId returned from Polymarket"};let f=await k(u,8e3,500);if(!f.filled||f.sizeFilled<=0)return d.k.warn(`Sell order ${u} NOT filled (status: ${f.status})`),{success:!1,error:`Order not filled (status: ${f.status})`,orderId:u};return d.k.info(`Sell FILLED: ${f.sizeFilled.toFixed(4)} shares @ $${f.avgPrice.toFixed(4)} | token=${e.slice(0,10)}...`),{success:!0,orderId:u,filledSize:f.sizeFilled,filledPrice:f.avgPrice||l}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`Sell order failed: ${e}`),{success:!1,error:e}}}async function E(e,r,t,i,n){let o=await f();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=await o.createAndPostOrder({tokenID:e,price:r,side:s.Side.BUY,size:t,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:i,negRisk:n},s.OrderType.GTC,!1,!0);return d.k.info(`[ARB] Limit buy placed: ${t.toFixed(2)} shares @ $${r} | token=${e}`),{success:!0,orderId:a?.orderID||a?.orderIds?.[0]||"unknown"}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`[ARB] Limit buy failed: ${e}`),{success:!1,error:e}}}async function m(e){let r=await f();if(!r)return{success:!1,error:"CLOB client not initialized"};try{return await r.cancelOrders(e),d.k.info(`[ARB] Cancelled ${e.length} orders`),{success:!0}}catch(r){let e=r instanceof Error?r.message:String(r);return d.k.error(`[ARB] Batch cancel failed: ${e}`),{success:!1,error:e}}}async function C(e){let r=await f();if(!r)return null;try{let t=await r.getOrder(e);if(!t)return null;let i=parseFloat(t.size_matched||"0");parseFloat(t.original_size||"0");let s=parseFloat(t.price||"0"),n=t.status||"unknown";return{filled:i>0,sizeFilled:i,sizeMatched:i,status:n,price:s}}catch(r){return d.k.error(`Failed to get order status for ${e}: ${r}`),null}}async function k(e,r=5e3,t=500){let i=Date.now(),s=null;for(;Date.now()-i<r;){if(!(s=await C(e))){await new Promise(e=>setTimeout(e,t));continue}let r=s.status.toUpperCase();if("MATCHED"===r||"CLOSED"===r||"FILLED"===r)return{filled:s.sizeFilled>0,sizeFilled:s.sizeFilled,avgPrice:s.price,status:s.status};if("CANCELLED"===r||"EXPIRED"===r||"REJECTED"===r)return{filled:!1,sizeFilled:0,avgPrice:0,status:s.status};s.sizeFilled,await new Promise(e=>setTimeout(e,t))}return{filled:!!s&&s.sizeFilled>0,sizeFilled:s?.sizeFilled||0,avgPrice:s?.price||0,status:s?.status||"timeout"}}let F="0x4D97DCd97eC945f40cF65F87097ACe5EA0476045",I=["function redeemPositions(address collateralToken, bytes32 parentCollectionId, bytes32 conditionId, uint256[] indexSets)","function balanceOf(address owner, uint256 id) view returns (uint256)"],g=["function redeemPositions(bytes32 conditionId, uint256[] amounts)"];async function L(e,r){let i=process.env.PRIVATE_KEY;if(!i)return{success:!1,error:"No PRIVATE_KEY"};try{let s=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",a=new o.StaticJsonRpcProvider(s,137),l=new n.Wallet(i,a),{Contract:c}=await Promise.resolve().then(t.t.bind(t,12792,23)),u=[1,2];if(r){let r=new c("0xd91E80cF2E7be2e162c6513ceD06f1dD0dA35296",g,l),t=new c(F,I,a),i=!1;for(let r of u)try{let s=BigInt(e)+BigInt(r),n=await t.balanceOf(l.address,s);Number(n)>0&&(i=!0)}catch{i=!0;break}if(!i)return d.k.info(`[Redeem] No tokens to redeem for ${e.slice(0,10)}...`),{success:!0};let s=await r.redeemPositions(e,u);await s.wait(),d.k.info(`[Redeem] Neg-risk redemption tx: ${s.hash}`)}else{let r=new c(F,I,l),t=await r.redeemPositions("0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174","0x0000000000000000000000000000000000000000000000000000000000000000",e,u);await t.wait(),d.k.info(`[Redeem] CTF redemption tx: ${t.hash}`)}return{success:!0}}catch(t){let r=t instanceof Error?t.message:String(t);return d.k.error(`[Redeem] Failed for ${e.slice(0,10)}...: ${r}`),{success:!1,error:r}}}i()}catch(e){i(e)}})}};