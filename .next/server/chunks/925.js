"use strict";exports.id=925,exports.ids=[925],exports.modules={43895:(e,t,r)=>{r.d(t,{k:()=>d});var n=r(94624),i=r.n(n),s=r(92048),o=r(55315);let a=process.env.LOG_FILE||(0,o.join)(process.cwd(),"data","bot.log"),c=process.env.LOG_LEVEL||"info",l=(0,o.dirname)(a);(0,s.existsSync)(l)||(0,s.mkdirSync)(l,{recursive:!0});let d=i().createLogger({level:c,format:i().format.combine(i().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),i().format.printf(({timestamp:e,level:t,message:r,...n})=>{let i=Object.keys(n).length?` ${JSON.stringify(n)}`:"";return`[${e}] ${t.toUpperCase()}: ${r}${i}`})),transports:[new(i()).transports.Console({format:i().format.combine(i().format.colorize(),i().format.timestamp({format:"HH:mm:ss"}),i().format.printf(({timestamp:e,level:t,message:r})=>`[${e}] ${t}: ${r}`))}),new(i()).transports.File({filename:a,maxsize:10485760,maxFiles:5})]})},21925:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{A_:()=>$,EG:()=>A,L4:()=>m,SX:()=>C,YX:()=>S,_e:()=>k,checkProxyTokenBalance:()=>y,fA:()=>g,pQ:()=>E,tS:()=>p});var i=r(67332),s=r(47152),o=r(90399),a=r(12792),c=r(99648),l=r(35240),d=r.n(l),u=r(43895),f=e([i,c]);[i,c]=f.then?(await f)():f;let h=new(d()).Agent({ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",keepAlive:!0});c.default.interceptors.request.use(e=>(e.headers["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36",e.headers.Accept="application/json, text/plain, */*",e.headers["Accept-Language"]="en-US,en;q=0.9",e.headers.Connection="keep-alive",e.httpAgent=e.httpAgent||h,e.httpsAgent=e.httpsAgent||h,e.timeout=e.timeout||5e3,e));let R=null,L=null,P=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com";async function p(){if(R)return R;let e=process.env.PRIVATE_KEY,t=process.env.FUNDER_ADDRESS,r=process.env.CLOB_API_URL||"https://clob.polymarket.com",n=parseInt(process.env.CHAIN_ID||"137"),a=parseInt(process.env.SIGNATURE_TYPE||"2");if(!e||!t)return u.k.warn("No PRIVATE_KEY or FUNDER_ADDRESS set â€” live trading unavailable"),null;try{let c=new o.StaticJsonRpcProvider(P,137),l=new s.Wallet(e,c),d=process.env.CLOB_API_KEY,f=process.env.CLOB_SECRET,p=process.env.CLOB_PASSPHRASE;if(d&&f&&p)L={key:d,secret:f,passphrase:p},u.k.info("Using pre-configured CLOB API keys from .env");else{let e=new i.ClobClient(r,n,l,void 0,a,t);L=await e.createOrDeriveApiKey(),u.k.info("API keys derived from Polymarket")}return R=new i.ClobClient(r,n,l,L,a,t),u.k.info("CLOB client initialized successfully"),R}catch(e){return u.k.error(`Failed to initialize CLOB client: ${e}`),null}}function S(){let e=process.env.CLOB_API_URL||"https://clob.polymarket.com",t=parseInt(process.env.CHAIN_ID||"137");return new i.ClobClient(e,t)}async function m(e,t,r,n,s){let o=await p();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=parseFloat(n)||.01,c=Math.min(.99,Math.round((t+.01)/a)*a);u.k.info(`[LIVE] BUY: ${r.toFixed(4)} shares @ $${c.toFixed(4)} (mid=$${t.toFixed(4)}) | token=${e.slice(0,10)}...`);let l=await o.createAndPostOrder({tokenID:e,price:c,side:i.Side.BUY,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:n,negRisk:s});u.k.info(`[LIVE] BUY response: ${JSON.stringify(l)}`);let d=l?.orderID||l?.orderIds?.[0];if(!d||"unknown"===d)return u.k.error("Buy order returned no orderId"),{success:!1,error:"No orderId returned from Polymarket"};let f=await w(d,8e3,500);if(!f.filled||f.sizeFilled<=0)return u.k.warn(`Buy order ${d} NOT filled (status: ${f.status})`),{success:!1,error:`Order not filled (status: ${f.status})`,orderId:d};return u.k.info(`Buy FILLED: ${f.sizeFilled.toFixed(4)} shares @ $${f.avgPrice.toFixed(4)} | token=${e.slice(0,10)}...`),{success:!0,orderId:d,filledSize:f.sizeFilled,filledPrice:f.avgPrice||c}}catch(t){let e=t instanceof Error?t.message:String(t);return u.k.error(`Buy order failed: ${e}`),{success:!1,error:e}}}async function A(e,t,r,n,s){let o=await p();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=parseFloat(n)||.01,c=Math.max(.01,Math.round((t-.01)/a)*a);u.k.info(`[LIVE] SELL: ${r.toFixed(4)} shares @ $${c.toFixed(4)} (mid=$${t.toFixed(4)}) | token=${e.slice(0,10)}...`);let l=await o.createAndPostOrder({tokenID:e,price:c,side:i.Side.SELL,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:n,negRisk:s});u.k.info(`[LIVE] SELL response: ${JSON.stringify(l)}`);let d=l?.orderID||l?.orderIds?.[0];if(!d||"unknown"===d)return u.k.error("Sell order returned no orderId"),{success:!1,error:"No orderId returned from Polymarket"};let f=await w(d,8e3,500);if(!f.filled||f.sizeFilled<=0)return u.k.warn(`Sell order ${d} NOT filled (status: ${f.status})`),{success:!1,error:`Order not filled (status: ${f.status})`,orderId:d};return u.k.info(`Sell FILLED: ${f.sizeFilled.toFixed(4)} shares @ $${f.avgPrice.toFixed(4)} | token=${e.slice(0,10)}...`),{success:!0,orderId:d,filledSize:f.sizeFilled,filledPrice:f.avgPrice||c}}catch(t){let e=t instanceof Error?t.message:String(t);return u.k.error(`Sell order failed: ${e}`),{success:!1,error:e}}}async function E(e,t,r,n,s){let o=await p();if(!o)return{success:!1,error:"CLOB client not initialized"};try{let a=await o.createAndPostOrder({tokenID:e,price:t,side:i.Side.BUY,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:n,negRisk:s},i.OrderType.GTC,!1,!0);return u.k.info(`[ARB] Limit buy placed: ${r.toFixed(2)} shares @ $${t} | token=${e}`),{success:!0,orderId:a?.orderID||a?.orderIds?.[0]||"unknown"}}catch(t){let e=t instanceof Error?t.message:String(t);return u.k.error(`[ARB] Limit buy failed: ${e}`),{success:!1,error:e}}}async function k(e){let t=await p();if(!t)return{success:!1,error:"CLOB client not initialized"};try{return await t.cancelOrders(e),u.k.info(`[ARB] Cancelled ${e.length} orders`),{success:!0}}catch(t){let e=t instanceof Error?t.message:String(t);return u.k.error(`[ARB] Batch cancel failed: ${e}`),{success:!1,error:e}}}async function C(e){let t=await p();if(!t)return null;try{let r=await t.getOrder(e);if(!r)return null;let n=parseFloat(r.size_matched||"0");parseFloat(r.original_size||"0");let i=parseFloat(r.price||"0"),s=r.status||"unknown";return{filled:n>0,sizeFilled:n,sizeMatched:n,status:s,price:i}}catch(t){return u.k.error(`Failed to get order status for ${e}: ${t}`),null}}async function w(e,t=5e3,r=500){let n=Date.now(),i=null;for(;Date.now()-n<t;){if(!(i=await C(e))){await new Promise(e=>setTimeout(e,r));continue}let t=i.status.toUpperCase();if("MATCHED"===t||"CLOSED"===t||"FILLED"===t)return{filled:i.sizeFilled>0,sizeFilled:i.sizeFilled,avgPrice:i.price,status:i.status};if("CANCELLED"===t||"EXPIRED"===t||"REJECTED"===t)return{filled:!1,sizeFilled:0,avgPrice:0,status:i.status};i.sizeFilled,await new Promise(e=>setTimeout(e,r))}return{filled:!!i&&i.sizeFilled>0,sizeFilled:i?.sizeFilled||0,avgPrice:i?.price||0,status:i?.status||"timeout"}}let D="0x4D97DCd97eC945f40cF65F87097ACe5EA0476045",I="0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",F=["function redeemPositions(address collateralToken, bytes32 parentCollectionId, bytes32 conditionId, uint256[] indexSets)","function balanceOf(address owner, uint256 id) view returns (uint256)","function getCollectionId(bytes32 parentCollectionId, bytes32 conditionId, uint256 indexSet) view returns (bytes32)","function getPositionId(address collateralToken, bytes32 collectionId) view returns (uint256)","function payoutDenominator(bytes32 conditionId) view returns (uint256)"],_=["function redeemPositions(bytes32 conditionId, uint256[] indexSets)"],O=["function execTransaction(address to, uint256 value, bytes data, uint8 operation, uint256 safeTxGas, uint256 baseGas, uint256 gasPrice, address gasToken, address refundReceiver, bytes signatures) payable returns (bool)","function getTransactionHash(address to, uint256 value, bytes data, uint8 operation, uint256 safeTxGas, uint256 baseGas, uint256 gasPrice, address gasToken, address refundReceiver, uint256 _nonce) view returns (bytes32)","function nonce() view returns (uint256)"];async function y(e){let t=process.env.FUNDER_ADDRESS;if(!t)return!1;try{let r=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",n=new o.StaticJsonRpcProvider(r,137),i=new a.Contract(D,F,n);for(let r of[1,2])try{let n=await i.getCollectionId("0x0000000000000000000000000000000000000000000000000000000000000000",e,r),s=await i.getPositionId(I,n),o=await i.balanceOf(t,s);if(Number(o)>0)return u.k.info(`[Redeem] Proxy has ${o.toString()} tokens for ${e.slice(0,10)}... (idx=${r})`),!0}catch{}return!1}catch(t){return u.k.warn(`[Redeem] Balance check failed for ${e.slice(0,10)}...: ${t}`),!1}}async function v(e){try{let t=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",r=new o.StaticJsonRpcProvider(t,137),n=new a.Contract(D,F,r),i=await n.payoutDenominator(e);return Number(i)>0}catch{return!1}}async function $(){let e=await p(),t=process.env.FUNDER_ADDRESS;if(!e||!t)return[];try{let r=await e.getTrades(void 0,!1);if(!r||0===r.length)return u.k.info("[Redeem] CLOB API returned 0 trades"),[];let n=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",i=new o.StaticJsonRpcProvider(n,137),s=new a.Contract(D,F,i),c=new Map;for(let e of r)e.market&&e.asset_id&&(c.has(e.market)||c.set(e.market,new Set),c.get(e.market).add(e.asset_id));u.k.info(`[Redeem] CLOB API: ${r.length} trades across ${c.size} markets`);let l=[],d=new Set;for(let[r,n]of c)for(let i of n)try{let n=await s.balanceOf(t,i);if(Number(n)>0&&(u.k.info(`[Redeem] Found ${n.toString()} tokens for ${r.slice(0,10)}... tokenId=${i.slice(0,10)}...`),!d.has(r))){d.add(r);let t=await e.getNegRisk(i).catch(()=>!0);l.push({conditionId:r,negRisk:!!t})}}catch(e){u.k.debug(`[Redeem] balanceOf failed for token ${i.slice(0,10)}...: ${e}`)}return u.k.info(`[Redeem] Found ${l.length} claimable position(s)`),l}catch(e){return u.k.error(`[Redeem] Failed to scan: ${e}`),[]}}async function g(e,t){let n=process.env.PRIVATE_KEY,i=process.env.FUNDER_ADDRESS;if(!n||!i)return{success:!1,error:"No PRIVATE_KEY or FUNDER_ADDRESS"};try{let c,l;let d=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",f=new o.StaticJsonRpcProvider(d,137),p=new s.Wallet(n,f),{Interface:S}=await Promise.all([r.e(805),r.e(267)]).then(r.bind(r,63267)),{arrayify:m,hexlify:A}=await r.e(805).then(r.bind(r,91805)),E="0x0000000000000000000000000000000000000000",k=[1,2];if(!await v(e))return u.k.info(`[Redeem] Condition ${e.slice(0,10)}... not yet resolved on-chain`),{success:!1,error:"Condition not yet resolved on-chain"};if(!await y(e))return u.k.info(`[Redeem] No tokens at proxy wallet for ${e.slice(0,10)}...`),{success:!0};t?(l=new S(_).encodeFunctionData("redeemPositions",[e,k]),c="0xd91E80cF2E7be2e162c6513ceD06f1dD0dA35296"):(l=new S(F).encodeFunctionData("redeemPositions",[I,"0x0000000000000000000000000000000000000000000000000000000000000000",e,k]),c=D);let C=new a.Contract(i,O,p),w=await C.nonce(),$=await C.getTransactionHash(c,0,l,0,0,0,0,E,E,w),g=await p.signMessage(m($)),h=m(g);h[64]+=4;let R=A(h),L=await C.execTransaction(c,0,l,0,0,0,0,E,E,R,{gasLimit:5e5}),P=await L.wait();if(0===P.status)return u.k.error(`[Redeem] Safe tx reverted: ${L.hash} | conditionId=${e.slice(0,10)}...`),{success:!1,error:"Safe transaction reverted on-chain"};return u.k.info(`[Redeem] Claimed via Safe tx: ${L.hash} | conditionId=${e.slice(0,10)}...`),{success:!0}}catch(r){let t=r instanceof Error?r.message:String(r);return u.k.error(`[Redeem] Failed for ${e.slice(0,10)}...: ${t}`),{success:!1,error:t}}}n()}catch(e){n(e)}})}};