"use strict";exports.id=103,exports.ids=[103],exports.modules={57103:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{BU:()=>y,ap:()=>S,hC:()=>M,xS:()=>v,y0:()=>P,zX:()=>D});var a=n(97320),r=n(9854),s=n(3412),o=n(24979),l=n(21925),c=n(91162),d=n(47152),u=n(90399),p=n(12792),f=n(43895),g=e([a,o,l,c]);[a,o,l,c]=g.then?(await g)():g;let O="stopped",x="disconnected",F="Idle",L=null,R=null,_=null,H=new Map,B=new Map,N=[],U=[],z=[],W=0,Y=0,G=!1,J=null,X=null,V=[],q=0,j=null,K=null,Q=null,Z=null,ee=0;function m(){let e=Date.now();return(!Z||e-ee>2e3)&&(Z=(0,s.Gw)(),ee=e),Z}function S(){Z=null,ee=0}let et=!1,en=null,ei=null,ea=0,er={},es=new Set,eo=!1;function h(){if(eo)return;eo=!0;let e=m();(0,o.up)(e.enabledAssets),f.k.info("[Engine] Auto-started market scanner for dashboard")}let el="";function w(e){let t="yes"===e.side?o.rs(e.asset)?.yesPrice??e.entryPrice:o.rs(e.asset)?.noPrice??e.entryPrice;return{id:e.id,conditionId:e.conditionId,slug:e.slug,asset:e.asset,side:e.side,entryPrice:e.entryPrice,shares:e.shares,costBasis:e.costBasis,currentPrice:t,sellPrice:e.sellPrice,sellOrderId:e.sellOrderId,buyOrderId:e.buyOrderId,entryTime:e.entryTime,windowEndTs:e.windowEndTs,unrealizedPnl:e.shares*t-e.costBasis}}function $(e){return{orderId:e.orderId,conditionId:e.conditionId,slug:e.slug,asset:e.asset,side:e.side,price:e.price,size:e.size,placedAt:e.placedAt}}function y(e){return h(),function(){if(Q)return;let e=0;Q=setInterval(()=>{if(0===es.size)return;let t=m(),n={};for(let e of(0,o.$2)())n[e.asset]=e;0===Object.keys(n).length?(e++,(5===e||e%30==0)&&f.k.warn(`[Engine] No active markets found after ${e} broadcast cycles`)):e=0;let i=(0,o.bp)(t.enabledAssets),a=JSON.stringify(i),s=a!==el;s&&(el=a);let l=(0,c.zk)(),d=(0,r.vT)(l);k({type:"price",data:{markets:n,...s?{recentOutcomes:i}:{},scalp:{binancePrice:(0,c.iS)(),windowOpenPrice:(0,c.as)(),btcChangePercent:l,fairValue:d,positions:U.map(w),pendingBuys:z.map($),cooldownUntil:W}},timestamp:new Date().toISOString()})},1e3)}(),(0,c.md)(),es.add(e),e({type:"state",data:P(),timestamp:new Date().toISOString()}),()=>es.delete(e)}function k(e){for(let t of es)try{t(e)}catch{es.delete(t)}}function I(){k({type:"state",data:P(),timestamp:new Date().toISOString()})}function A(e){k({type:"log",data:{message:e},timestamp:new Date().toISOString()})}function E(e,t,n){let i={id:`alert-${++q}`,timestamp:new Date().toISOString(),severity:e,message:t,asset:n};V.unshift(i),V.length>100&&(V.length=100),k({type:"alert",data:i,timestamp:i.timestamp})}function T(e){let t=0;for(let e of U)t+=e.costBasis;for(let e of z)t+=e.price*e.size;let n=(0,s._l)(),i=(0,s.uF)(),a=(0,s.vs)();return{totalBankroll:e.totalBankroll,deployed:t,available:Math.max(0,e.maxTotalExposure-t),maxExposure:e.maxTotalExposure,todayPnl:n,winStreak:a,totalLosses:i}}function P(){let e;let t=m(),n=(0,a.pi)();!function(){let e=Date.now();if(e-ea<3e4)return;ea=e;let t=process.env.PRIVATE_KEY,n=process.env.FUNDER_ADDRESS;if(t)try{let e=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",i=new u.StaticJsonRpcProvider(e,137),a=new d.Wallet(t,i);ei=n||a.address;let r=["function balanceOf(address) view returns (uint256)"],s=new p.Contract("0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",r,i),o=new p.Contract("0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359",r,i),c=[];n&&c.push(n),n&&n.toLowerCase()===a.address.toLowerCase()||c.push(a.address),Promise.all(c.flatMap(e=>[s.balanceOf(e).then(e=>Number(e)/1e6).catch(()=>0),o.balanceOf(e).then(e=>Number(e)/1e6).catch(()=>0)])).then(e=>{let t=e.reduce((e,t)=>e+t,0);en=t,et&&(0,l.tS)().then(e=>{e&&e.getBalanceAllowance({asset_type:"COLLATERAL"}).then(e=>{let n=e?.balance||"0",i=parseFloat(n);en=t+(i>1e6?i/1e6:i)}).catch(()=>{})}).catch(()=>{})}).catch(()=>{})}catch{}}();let i=!1;R?_?i=!0:e="Waiting for price data":e="No active market found";let f={market:R,prices:_,secondsRemaining:n,eligible:i,ineligibleReason:e},g={};for(let e of(0,o.$2)())g[e.asset]=e;let S={};for(let[e,t]of H)S[e]=t;let h=(0,c.zk)(),y=(0,r.vT)(h);return{status:O,connection:x,lastAction:F,lastActionTime:L,currentMarket:f,currentPosition:null,settings:t,cumulativePnl:(0,s.NW)(),totalTrades:(0,s.yW)(),activeMarkets:g,positions:S,capital:T(t),circuitBreaker:{triggered:G,reason:J,resumeAt:X,dailyPnl:(0,s._l)(),totalLosses:(0,s.uF)()},clobReady:et,alerts:V.slice(0,50),arbState:null,arbStats:{windowsPlayed:0,bothSidesFilled:0,oneSideFilled:0,neitherFilled:0,totalPnl:0,avgProfitPerWindow:0},walletBalance:en,walletAddress:ei,scalp:{binancePrice:(0,c.iS)(),windowOpenPrice:(0,c.as)(),btcChangePercent:h,fairValue:y,positions:U.map(w),pendingBuys:z.map($),cooldownUntil:W}}}async function C(){try{x="connecting";let e=await (0,a.ri)();if(e){R&&R.conditionId!==e.conditionId&&f.k.info(`Market rotated: ${R.slug} -> ${e.slug}`),R=e,B.set(e.conditionId,e),x="connected";let t=await (0,a.pw)(e);t&&(_=t)}else R=null,_=null,x="connected"}catch(e){x="disconnected",f.k.error(`Market refresh failed: ${e?.message||e}`)}I()}let ec=!1;async function b(){if("running"===O&&!ec){ec=!0;try{let t=m();if(function(e){if(G){if(X){let e=new Date(X).getTime();if(Date.now()>=e)return G=!1,J=null,X=null,E("info","Circuit breaker cooldown ended. Bot resumed."),!1}return!0}let t=(0,s._l)();if(t<-e.dailyLossLimit)return G=!0,J=`Daily loss $${Math.abs(t).toFixed(2)} exceeded limit $${e.dailyLossLimit}`,X=new Date(Date.now()+144e5).toISOString(),E("error",`Circuit breaker triggered: ${J}. Pausing for 4 hours.`),!0;let n=(0,s.uF)();return n>=e.lossLimit&&(G=!0,J=`${n} losses today (limit: ${e.lossLimit})`,E("error",`Circuit breaker triggered: ${J}. Bot stopped.`),!0)}(t)){I();return}if(!t.scalpEnabled){ec=!1;return}let i=(0,o.$2)(),d=Date.now(),u=(0,c.zk)(),p=(0,r.vT)(u),g=(0,c.cs)();for(let n=z.length-1;n>=0;n--){let i=z[n],a=1e3*i.windowEndTs;if(d>a){try{await (0,l.sl)(i.orderId)}catch{}f.k.info(`[SCALP] Cancelled expired buy order ${i.orderId}`),z.splice(n,1);continue}let r=await (0,l.SX)(i.orderId);if(!r)continue;let u=r.status.toUpperCase();if("MATCHED"===u||"CLOSED"===u||"FILLED"===u){if(r.sizeFilled>0){var e;let a=r.price||i.price,u=r.sizeFilled,p=u*a,f=Math.min(.99,Math.round((a+t.scalpProfitTarget)*100)/100);e=(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:i.conditionId,slug:i.slug,side:i.side,action:"buy",price:a,amount:p,shares:u,pnl:null,paper:t.paperTrading,orderId:i.orderId,asset:i.asset,subStrategy:"scalp",binancePriceAtEntry:(0,c.iS)(),slippage:null,takerFee:0}),k({type:"trade",data:e,timestamp:new Date().toISOString()});let g=null;if(!t.paperTrading){let e=await (0,l.eE)(i.tokenId,f,u,i.tickSize,i.negRisk);e.success&&e.orderId&&(g=e.orderId)}let m=`scalp-${i.conditionId.slice(0,8)}-${Date.now()}`;U.push({id:m,conditionId:i.conditionId,slug:i.slug,asset:i.asset,side:i.side,tokenId:i.tokenId,entryPrice:a,shares:u,costBasis:p,sellPrice:f,sellOrderId:g,buyOrderId:i.orderId,entryTime:d,windowEndTs:i.windowEndTs}),F=`Scalp buy ${i.asset} ${i.side.toUpperCase()} @ $${a.toFixed(2)}`,L=new Date().toISOString(),A(`Scalp entry: ${i.side.toUpperCase()} ${u.toFixed(1)} shares @ $${a.toFixed(2)}, sell target $${f.toFixed(2)}`),E("info",`Scalp buy: ${i.side.toUpperCase()} @ $${a.toFixed(2)}`,i.asset),z.splice(n,1),B.set(i.conditionId,o.rs(i.asset)?.market)}}else("CANCELLED"===u||"EXPIRED"===u||"REJECTED"===u)&&z.splice(n,1)}for(let e=U.length-1;e>=0;e--){let i=U[e],c=(0,o.rs)(i.asset),f=c?"yes"===i.side?c.yesPrice:c.noPrice:i.entryPrice,g=i.windowEndTs,m=Math.max(0,g+900-Math.floor(d/1e3));if(i.sellOrderId&&!t.paperTrading){let n=await (0,l.SX)(i.sellOrderId);if(n){let a=n.status.toUpperCase();if(("MATCHED"===a||"CLOSED"===a||"FILLED"===a)&&n.sizeFilled>0){let a=n.price||i.sellPrice,r=i.shares*a-i.costBasis;(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:i.conditionId,slug:i.slug,side:i.side,action:"sell",price:a,amount:i.shares*a,shares:i.shares,pnl:r,paper:!1,orderId:i.sellOrderId,asset:i.asset,subStrategy:"scalp",binancePriceAtEntry:null,slippage:null,takerFee:0}),A(`Scalp exit: ${i.side.toUpperCase()} @ $${a.toFixed(2)} | P&L: $${r.toFixed(4)}`),E(r>=0?"success":"warning",`Scalp sold @ $${a.toFixed(2)} | P&L: $${r.toFixed(4)}`,i.asset),F=`Scalp sold ${i.asset} @ $${a.toFixed(2)}`,L=new Date().toISOString(),r<0&&(W=900*Math.floor(d/1e3/900)+900*t.scalpCooldownWindows),U.splice(e,1);continue}}}let S=(0,r.S2)(i.entryPrice,i.sellPrice,f,u,i.side,m,t.scalpProfitTarget);if("trail"===S.action&&S.sellPrice&&S.sellPrice>i.sellPrice){if(i.sellOrderId&&!t.paperTrading)try{await (0,l.sl)(i.sellOrderId)}catch{}let e=S.sellPrice,n=null;if(!t.paperTrading&&c){let t=await (0,l.eE)(i.tokenId,e,i.shares,c.tickSize,c.negRisk);t.success&&t.orderId&&(n=t.orderId)}i.sellPrice=e,i.sellOrderId=n,A(`Trail sell: ${i.side.toUpperCase()} $${i.sellPrice.toFixed(2)} (fair $${("yes"===i.side?p.up:p.down).toFixed(2)})`)}else if("sell_profit"===S.action||"sell_loss"===S.action){if(i.sellOrderId&&!t.paperTrading)try{await (0,l.sl)(i.sellOrderId)}catch{}let a=S.sellPrice||f,r=i.shares*a-i.costBasis;if(!t.paperTrading&&c){let{placeSellOrder:e}=await Promise.resolve().then(n.bind(n,21925));await e(i.tokenId,a,i.shares,c.tickSize,c.negRisk)}(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:i.conditionId,slug:i.slug,side:i.side,action:"sell",price:a,amount:i.shares*a,shares:i.shares,pnl:r,paper:t.paperTrading,orderId:null,asset:i.asset,subStrategy:"scalp",binancePriceAtEntry:null,slippage:null,takerFee:0}),A(`${"sell_profit"===S.action?"Profit exit":"Loss cut"}: ${i.side.toUpperCase()} @ $${a.toFixed(2)} | P&L: $${r.toFixed(4)}`),E(r>=0?"success":"warning",`Scalp ${"sell_profit"===S.action?"profit":"loss"} @ $${a.toFixed(2)}`,i.asset),r<0&&(W=900*Math.floor(d/1e3/900)+900*t.scalpCooldownWindows),U.splice(e,1);continue}else"hold_resolution"===S.action&&A(S.reason);if(m<=0){let n=B.get(i.conditionId);if(n){let r=await (0,a.r_)(i.slug);if(null===r&&(r=await (0,a.P_)(n)),null!==r){let a=i.side===r,c=a?1:0,u=i.shares*c-i.costBasis;if(i.sellOrderId&&!t.paperTrading)try{await (0,l.sl)(i.sellOrderId)}catch{}(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:i.conditionId,slug:i.slug,side:i.side,action:"resolution",price:c,amount:i.shares*c,shares:i.shares,pnl:u,paper:t.paperTrading,orderId:null,asset:i.asset,subStrategy:"scalp",binancePriceAtEntry:null,slippage:null,takerFee:null}),(0,o.E3)(i.slug,"yes"===r?"up":"down"),A(`Resolution: ${i.side.toUpperCase()} ${a?"WON":"LOST"} | P&L: $${u.toFixed(4)}`),E(a?"success":"warning",`Resolved ${a?"WON":"LOST"}: $${u.toFixed(4)}`,i.asset),!t.paperTrading&&a&&N.push({conditionId:n.conditionId,negRisk:n.negRisk,asset:i.asset,attempts:0,nextAttempt:d+5e3}),u<0&&(W=900*Math.floor(d/1e3/900)+900*t.scalpCooldownWindows),U.splice(e,1)}}}}if(d-Y>=5e3&&g){Y=d;let e=900*Math.floor(d/1e3/900);if(W>e){let t=Math.ceil((W-e)/900),n=er._cooldown;(!n||d-n.time>=15e3)&&(er._cooldown={reason:"cooldown",time:d},A(`Cooldown: skipping ${t} more window(s) after loss`))}else for(let e of i){if(!t.enabledAssets.includes(e.asset))continue;let n=U.filter(t=>t.conditionId===e.conditionId).length,i=z.filter(t=>t.conditionId===e.conditionId).length;if(n+i>=t.scalpMaxPositions||T(t).available<t.scalpTradeSize||e.secondsRemaining<180)continue;let a=(0,r.XE)(u,e.yesPrice,e.noPrice,t.scalpMinGap,t.scalpEntryMin,t.scalpEntryMax);if(a){let n="yes"===a.side?e.yesTokenId:e.noTokenId,i=t.scalpTradeSize/a.actualPrice,r=parseInt(e.slug.split("-").pop()||"0",10);if(t.paperTrading){let o=`scalp-paper-${Date.now()}`,l=Math.min(.99,Math.round((a.actualPrice+t.scalpProfitTarget)*100)/100);(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:a.side,action:"buy",price:a.actualPrice,amount:t.scalpTradeSize,shares:i,pnl:null,paper:!0,orderId:o,asset:e.asset,subStrategy:"scalp",binancePriceAtEntry:(0,c.iS)(),slippage:null,takerFee:0}),U.push({id:o,conditionId:e.conditionId,slug:e.slug,asset:e.asset,side:a.side,tokenId:n,entryPrice:a.actualPrice,shares:i,costBasis:t.scalpTradeSize,sellPrice:l,sellOrderId:null,buyOrderId:o,entryTime:d,windowEndTs:r}),B.set(e.conditionId,e.market),A(`[PAPER] Scalp entry: ${a.reason} | sell target $${l.toFixed(2)}`),E("info",`Scalp buy: ${a.side.toUpperCase()} @ $${a.actualPrice.toFixed(2)}`,e.asset)}else{let t=await (0,l.pQ)(n,a.actualPrice,i,e.tickSize,e.negRisk);t.success&&t.orderId&&(z.push({orderId:t.orderId,conditionId:e.conditionId,slug:e.slug,asset:e.asset,side:a.side,tokenId:n,price:a.actualPrice,size:i,placedAt:d,windowEndTs:r,tickSize:e.tickSize,negRisk:e.negRisk}),B.set(e.conditionId,e.market),A(`Limit buy placed: ${a.reason}`),E("info",`Limit buy: ${a.side.toUpperCase()} @ $${a.actualPrice.toFixed(2)}`,e.asset))}F=`Scalp signal: ${a.side.toUpperCase()} @ $${a.actualPrice.toFixed(2)}`,L=new Date().toISOString()}}}for(let e=N.length-1;e>=0;e--){let t=N[e];if(!(d<t.nextAttempt)){t.attempts++;try{let n=await (0,l.fA)(t.conditionId,t.negRisk);n.success?(A(`${t.asset} winnings claimed on-chain (attempt ${t.attempts})`),E("success",`Claimed winnings for ${t.asset}`,t.asset),N.splice(e,1)):(f.k.info(`[Redeem] ${t.asset} attempt ${t.attempts}/20: ${n.error}`),t.attempts>=20?(E("warning",`Auto-claim failed for ${t.asset}`,t.asset),N.splice(e,1)):t.nextAttempt=d+3e4)}catch(n){f.k.error(`[Redeem] ${t.asset} attempt ${t.attempts} error: ${n}`),t.attempts>=20?N.splice(e,1):t.nextAttempt=d+3e4}}}}catch(e){f.k.error(`Trading loop error: ${e}`),A(`Error: ${e}`)}finally{ec=!1}I()}}async function D(){if("running"===O)return{success:!1,error:"Bot is already running"};f.k.info("Starting bot..."),O="running",F="Bot started",L=new Date().toISOString();let e=m();if(h(),(0,c.md)(),E("info",`Market scanner active for: ${e.enabledAssets.join(", ")}`),E("info","Binance BTC price feed connected"),e.paperTrading)et=!1,E("info","Paper mode - CLOB client not needed");else{try{await (0,l.tS)()?(et=!0,E("success","CLOB client ready for live trading")):(et=!1,E("error","CLOB client failed - check PRIVATE_KEY and FUNDER_ADDRESS"))}catch{et=!1,E("error","CLOB client initialization failed")}I()}if(!e.paperTrading)try{let e=await (0,l.A_)();if(e.length>0){let t=0;for(let n of e)!N.some(e=>e.conditionId===n.conditionId)&&(N.push({conditionId:n.conditionId,negRisk:n.negRisk,asset:"BTC",attempts:0,nextAttempt:Date.now()+5e3}),t++);t>0&&A(`Found ${t} claimable position(s) - queued for auto-claim`)}let t=(0,s.JU)(6);if(t.length>0){let{checkProxyTokenBalance:e}=await Promise.resolve().then(n.bind(n,21925)),i=0;for(let n of t)!N.some(e=>e.conditionId===n.conditionId)&&await e(n.conditionId)&&(N.push({conditionId:n.conditionId,negRisk:!0,asset:n.asset,attempts:0,nextAttempt:Date.now()+5e3}),i++);i>0&&A(`DB scan found ${i} additional claimable position(s)`)}0===N.length&&f.k.info("[Redeem] No unclaimed positions found")}catch(e){f.k.error(`[Redeem] Startup claim scan failed: ${e}`)}return C(),j=setInterval(b,1e3),K=setInterval(C,3e4),I(),A("Bot started - Scalp strategy active"),E("success","Bot started successfully"),{success:!0}}function M(){if("stopped"===O)return{success:!1,error:"Bot is already stopped"};for(let e of(f.k.info("Stopping bot..."),j&&(clearInterval(j),j=null),K&&(clearInterval(K),K=null),z))(0,l.sl)(e.orderId).catch(()=>{});for(let e of U)e.sellOrderId&&(0,l.sl)(e.sellOrderId).catch(()=>{});return z.length=0,O="stopped",et=!1,S(),F="Bot stopped",L=new Date().toISOString(),I(),A("Bot stopped"),E("info","Bot stopped"),{success:!0}}function v(){return G=!1,J=null,X=null,E("info","Circuit breaker manually reset"),I(),{success:!0}}i()}catch(e){i(e)}})},9854:(e,t,n)=>{n.d(t,{S2:()=>s,XE:()=>r,vT:()=>a});let i=[{change:0,value:.5},{change:3e-4,value:.51},{change:5e-4,value:.52},{change:.001,value:.555},{change:.0015,value:.58},{change:.002,value:.625},{change:.0025,value:.665},{change:.003,value:.72},{change:.004,value:.78},{change:.005,value:.85},{change:.0075,value:.92},{change:.01,value:.96},{change:.015,value:.98}];function a(e){let t=function(e){if(e<=i[0].change)return i[0].value;if(e>=i[i.length-1].change)return i[i.length-1].value;for(let t=1;t<i.length;t++)if(e<=i[t].change){let n=i[t-1],a=i[t],r=(e-n.change)/(a.change-n.change);return n.value+r*(a.value-n.value)}return i[i.length-1].value}(Math.abs(e));return e>=0?{up:t,down:1-t}:{up:1-t,down:t}}function r(e,t,n,i,r,s){if(function(e,t=5e-4){return Math.abs(e)<t}(e))return null;let o=a(e),l=o.up-t,c=o.down-n,d=l>=i&&t>=r&&t<=s,u=c>=i&&n>=r&&n<=s;return d||u?d&&(!u||l>=c)?{side:"yes",fairValue:o.up,actualPrice:t,gap:l,reason:`UP undervalued: $${t.toFixed(2)} vs fair $${o.up.toFixed(2)} (gap $${l.toFixed(2)})`}:{side:"no",fairValue:o.down,actualPrice:n,gap:c,reason:`DOWN undervalued: $${n.toFixed(2)} vs fair $${o.down.toFixed(2)} (gap $${c.toFixed(2)})`}:null}function s(e,t,n,i,r,s,o){let l=a(i),c="yes"===r?l.up:l.down,d=Math.max(t,c-.03);if(d>t+.01)return{action:"trail",sellPrice:Math.min(.99,Math.round(100*d)/100),reason:`Trail sell up: $${t.toFixed(2)} ? $${d.toFixed(2)} (fair $${c.toFixed(2)})`};if(s<=120){let t=n>e,a="yes"===r&&i>3e-4||"no"===r&&i<-.0003;return t?{action:"sell_profit",sellPrice:n,reason:`Time exit: in profit $${n.toFixed(2)} > entry $${e.toFixed(2)}, ${s}s left`}:!t&&a?{action:"hold_resolution",reason:`Hold to resolution: BTC supports ${r.toUpperCase()} (${(100*i).toFixed(3)}%), ${s}s left`}:{action:"sell_loss",sellPrice:n,reason:`Cut loss: $${n.toFixed(2)} < entry $${e.toFixed(2)}, BTC reversed, ${s}s left`}}return{action:"hold",reason:"Holding -- waiting for profit target or time exit"}}},97320:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{P_:()=>S,pi:()=>u,pw:()=>h,r_:()=>m,ri:()=>f});var a=n(35240),r=n.n(a),s=n(67332),o=n(21925),l=n(43895),c=e([s,o]);async function d(e,t,n=3){for(let i=0;i<n;i++)try{return await function(e,t){let n=new URLSearchParams(t).toString(),i=`${e}?${n}`;return new Promise((e,t)=>{let n=r().get({hostname:"gamma-api.polymarket.com",path:i,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"},ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",ecdhCurve:"prime256v1:secp384r1",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",timeout:1e4},n=>{if(n.statusCode&&n.statusCode>=400){let e=Error(`${n.statusCode} ${n.statusMessage}`);e.status=n.statusCode,n.resume(),t(e);return}let i="";n.on("data",e=>i+=e),n.on("end",()=>{try{e(JSON.parse(i))}catch(e){t(e)}})});n.on("error",t),n.on("timeout",()=>{n.destroy(),t(Error("timeout"))})})}(e,t)}catch(s){if(i===n-1)throw s;let a=s.status;if(a&&a>=400&&a<500&&429!==a)throw s;let r=Math.min(1e3*Math.pow(2,i),8e3);l.k.warn(`[Markets] ${e}?${new URLSearchParams(t)} failed (attempt ${i+1}/${n}), retrying in ${r}ms`),await new Promise(e=>setTimeout(e,r))}throw Error("Unreachable")}function u(){let e=Math.floor(Date.now()/1e3);return(Math.floor(e/900)+1)*900-e}async function p(e){try{let t=await d("/markets",{slug:e});if(!t||!Array.isArray(t)||0===t.length)return l.k.debug(`No market found for slug: ${e}`),null;let n=t[0],i=n.clobTokenIds?"string"==typeof n.clobTokenIds?JSON.parse(n.clobTokenIds):n.clobTokenIds:[];if(i.length<2)return l.k.warn(`Market ${e} has insufficient token IDs`),null;return{conditionId:n.conditionId,slug:n.slug||e,question:n.question||"BTC 15m candle",yesTokenId:i[0],noTokenId:i[1],endDate:n.endDate||n.endDateIso||"",endTimestamp:n.endDate?new Date(n.endDate).getTime()/1e3:0,active:!1!==n.active&&!n.closed,tickSize:n.orderPriceMinTickSize||"0.01",negRisk:!0===n.negRisk}}catch(t){if(404===t.status)return null;return l.k.error(`Error fetching market ${e}: ${t.message||t}`),null}}async function f(){let e=function(){let e=Math.floor(Date.now()/1e3);return`btc-updown-15m-${900*Math.floor(e/900)}`}(),t=await p(e);if(t&&t.active)return t;let n=Math.floor(Date.now()/1e3),i=`btc-updown-15m-${(Math.floor(n/900)-1)*900}`;return(t=await p(i))&&t.active?t:null}async function g(e){try{let t=(0,o.YX)(),[n,i]=await Promise.all([t.getOrderBook(e.yesTokenId).catch(()=>null),t.getOrderBook(e.noTokenId).catch(()=>null)]),a=.5,r=.5;n&&(n.asks&&n.asks.length>0?a=parseFloat(n.asks[0].price):n.last_trade_price&&(a=parseFloat(n.last_trade_price))),i&&(i.asks&&i.asks.length>0?r=parseFloat(i.asks[0].price):i.last_trade_price&&(r=parseFloat(i.last_trade_price))),a>0&&.5===r?r=Math.max(.01,1-a):r>0&&.5===a&&(a=Math.max(.01,1-r));let s=a>=r?"yes":"no",l="yes"===s?a:r;return{yesPrice:a,noPrice:r,leadingSide:s,leadingPrice:l,timestamp:Date.now()}}catch(e){return l.k.error(`Error fetching prices: ${e}`),null}}async function m(e){try{let t=await d("/markets",{slug:e});if(!t||!Array.isArray(t)||0===t.length)return l.k.debug(`[Resolution] No market found for slug: ${e}`),null;let n=t[0];if(!0===n.active&&!n.closed)return l.k.debug(`[Resolution] ${e} still active (active=${n.active}, closed=${n.closed})`),null;if(n.outcomePrices){let t;if("string"==typeof n.outcomePrices)try{let e=JSON.parse(n.outcomePrices);t=Array.isArray(e)?e.map(Number):n.outcomePrices.split(",").map(Number)}catch{t=n.outcomePrices.split(",").map(Number)}else{if(!Array.isArray(n.outcomePrices))return l.k.debug(`[Resolution] ${e} unexpected outcomePrices type: ${typeof n.outcomePrices}`),null;t=n.outcomePrices.map(Number)}if(t.length>=2&&!t.some(isNaN)){if(t[0]>t[1])return l.k.info(`[Resolution] ${e} resolved YES/UP (prices: ${t})`),"yes";if(t[1]>t[0])return l.k.info(`[Resolution] ${e} resolved NO/DOWN (prices: ${t})`),"no"}l.k.debug(`[Resolution] ${e} outcomePrices inconclusive: ${JSON.stringify(t)}`)}else l.k.debug(`[Resolution] ${e} closed but no outcomePrices (active=${n.active}, closed=${n.closed})`);return null}catch(t){return l.k.error(`[Resolution] Failed to fetch ${e}: ${t}`),null}}async function S(e){try{let t=(0,o.YX)(),n=await t.getMidpoints([{token_id:e.yesTokenId,side:s.Side.BUY},{token_id:e.noTokenId,side:s.Side.BUY}]),i=parseFloat(n?.[e.yesTokenId]||"0"),a=parseFloat(n?.[e.noTokenId]||"0");if(l.k.debug(`[Resolution CLOB] ${e.slug} YES=${i} NO=${a}`),i>.9)return"yes";if(a>.9)return"no";return null}catch(t){return l.k.debug(`[Resolution CLOB] Failed for ${e.slug}: ${t}`),null}}async function h(e){try{let t=(0,o.YX)(),n=await t.getMidpoints([{token_id:e.yesTokenId,side:s.Side.BUY},{token_id:e.noTokenId,side:s.Side.BUY}]),i=parseFloat(n?.[e.yesTokenId]||"0.5"),a=parseFloat(n?.[e.noTokenId]||"0.5"),r=i>=a?"yes":"no";return{yesPrice:i,noPrice:a,leadingSide:r,leadingPrice:"yes"===r?i:a,timestamp:Date.now()}}catch{return g(e)}}[s,o]=c.then?(await c)():c,i()}catch(e){i(e)}})},91162:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{as:()=>p,cs:()=>g,iS:()=>u,md:()=>d,zk:()=>f});var a=n(89814),r=n(43895),s=e([a]);a=(s.then?(await s)():s)[0];let m=null,S=null,h=0,w=0,$=0,y=0,k=!1;function o(){return 900*Math.floor(Date.now()/1e3/900)}function l(){if(m){try{m.close()}catch{}m=null}try{m=new a.default("wss://stream.binance.com:9443/ws/btcusdt@miniTicker")}catch(e){r.k.error(`[BinanceWS] Failed to create WebSocket: ${e}`),c();return}m.on("open",()=>{r.k.info("[BinanceWS] Connected to Binance BTCUSDT stream")}),m.on("message",e=>{try{let t=JSON.parse(e.toString()),n=parseFloat(t.c);if(n>0){h=n,w=Date.now();let e=o();e!==y&&($=n,y=e,r.k.info(`[BinanceWS] New window ${e}: open price $${n.toFixed(2)}`))}}catch{}}),m.on("close",()=>{r.k.warn("[BinanceWS] Disconnected"),k&&c()}),m.on("error",e=>{r.k.error(`[BinanceWS] Error: ${e.message}`)})}function c(){S||(S=setTimeout(()=>{S=null,k&&l()},3e3))}function d(){k||(k=!0,l())}function u(){return h}function p(){let e=o();return y!==e&&h>0&&($=h,y=e),$}function f(){let e=p();return e<=0||h<=0?0:(h-e)/e}function g(){return w>0&&Date.now()-w<1e4}i()}catch(e){i(e)}})},24979:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{$2:()=>y,E3:()=>$,bp:()=>h,rs:()=>k,up:()=>w});var a=n(35240),r=n.n(a),s=n(21925),o=n(43895),l=n(67332),c=e([s,l]);async function d(e,t,n=3){for(let i=0;i<n;i++)try{return await function(e,t){let n=new URLSearchParams(t).toString(),i=`${e}?${n}`;return new Promise((e,t)=>{let n=r().get({hostname:"gamma-api.polymarket.com",path:i,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"},ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",ecdhCurve:"prime256v1:secp384r1",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",timeout:1e4},n=>{if(n.statusCode&&n.statusCode>=400){let e=Error(`${n.statusCode} ${n.statusMessage}`);e.status=n.statusCode,n.resume(),t(e);return}let i="";n.on("data",e=>i+=e),n.on("end",()=>{try{e(JSON.parse(i))}catch(e){t(e)}})});n.on("error",t),n.on("timeout",()=>{n.destroy(),t(Error("timeout"))})})}(e,t)}catch(s){if(i===n-1)throw s;let a=s.status;if(a&&a>=400&&a<500&&429!==a)throw s;let r=Math.min(1e3*Math.pow(2,i),8e3);o.k.warn(`[Scanner] ${e}?${new URLSearchParams(t)} failed (attempt ${i+1}/${n}), retrying in ${r}ms`),await new Promise(e=>setTimeout(e,r))}throw Error("Unreachable")}[s,l]=c.then?(await c)():c;let I={BTC:"btc",ETH:"eth",SOL:"sol",XRP:"xrp"},A=new Map,E=new Map,T=new Map,P=0,C=[];function u(e){let t=Math.floor(Date.now()/1e3);return Math.max(0,e+900-t)}async function p(e,t){let n=`${I[e]}-updown-15m-${t}`;try{let i=await d("/markets",{slug:n});if(!i||!Array.isArray(i)||0===i.length)return null;let a=i[0],r=a.clobTokenIds?"string"==typeof a.clobTokenIds?JSON.parse(a.clobTokenIds):a.clobTokenIds:[];if(r.length<2)return null;return{conditionId:a.conditionId,slug:a.slug||n,question:a.question||`${e} 15m candle`,yesTokenId:r[0],noTokenId:r[1],endDate:a.endDate||a.endDateIso||"",endTimestamp:a.endDate?new Date(a.endDate).getTime()/1e3:t+900,active:!1!==a.active&&!a.closed,tickSize:a.orderPriceMinTickSize||"0.01",negRisk:!0===a.negRisk,asset:e}}catch(n){return o.k.error(`[Scanner] fetchMarket(${e}, ${t}) failed: ${n.message||n}`),null}}async function f(e){let{current:t,prev:n}=function(){let e=Math.floor(Date.now()/1e3),t=900*Math.floor(e/900);return{current:t,prev:t-900}}();await Promise.all(e.map(async e=>{let i=E.get(e);if(!i||i.windowTs!==t)for(let i of[t,n]){let n=await p(e,i);if(n&&n.active){E.set(e,{market:n,windowTs:t});break}}})),await g(e);let i=Date.now(),a=JSON.stringify(e)!==JSON.stringify(C);(i-P>5e3||a)&&(P=i,C=[...e],m(e).catch(()=>{}))}async function g(e){let t=[],n=[];for(let i of e){let e=E.get(i);if(!e)continue;let{market:a}=e;a.active&&(0>=u(parseInt(a.slug.split("-").pop()||"0",10))||(t.push({asset:i,market:a}),n.push({token_id:a.yesTokenId,side:l.Side.BUY},{token_id:a.noTokenId,side:l.Side.BUY})))}if(0!==n.length)try{let e=(0,s.YX)(),i=await e.getMidpoints(n);for(let{asset:e,market:n}of t){let t=parseFloat(i?.[n.yesTokenId]||"0.5"),a=parseFloat(i?.[n.noTokenId]||"0.5"),r=parseInt(n.slug.split("-").pop()||"0",10),s=u(r);if(s>0){let i={asset:e,conditionId:n.conditionId,slug:n.slug,yesTokenId:n.yesTokenId,noTokenId:n.noTokenId,yesPrice:t,noPrice:a,combinedCost:t+a,secondsRemaining:s,market:n,tickSize:n.tickSize,negRisk:n.negRisk};A.set(e,i)}}}catch(t){let e=t instanceof Error?t.message:String(t);o.k.warn(`[Scanner] Batched price poll failed: ${e}`)}}async function m(e){let t=Math.floor(Date.now()/1e3),n=900*Math.floor(t/900),i=[];for(let t of e){let e=I[t];for(let t=1;t<=10;t++){let a=n-900*t,r=`${e}-updown-15m-${a}`,s=T.get(r);s&&"pending"!==s.result||i.push((async()=>{try{let e=await S(r),t=new Date((a+900)*1e3);T.set(r,{slug:r,timestamp:a,result:e,endTime:t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})}catch{}})())}}await Promise.all(i)}async function S(e){try{let t=await d("/markets",{slug:e},2);if(!t?.[0])return"pending";let n=t[0];if(!0===n.active&&!n.closed)return"pending";if(n.outcomePrices)try{let e;if("string"==typeof n.outcomePrices)try{let t=JSON.parse(n.outcomePrices);e=Array.isArray(t)?t.map(Number):n.outcomePrices.split(",").map(Number)}catch{e=n.outcomePrices.split(",").map(Number)}else e=Array.isArray(n.outcomePrices)?n.outcomePrices.map(Number):[];if(e.length>=2&&!e.some(isNaN)){if(e[0]>e[1])return"up";if(e[1]>e[0])return"down"}}catch{}let i=n.clobTokenIds?"string"==typeof n.clobTokenIds?JSON.parse(n.clobTokenIds):n.clobTokenIds:[];if(i.length>=2)try{let e=(0,s.YX)(),t=await e.getMidpoints([{token_id:i[0],side:l.Side.BUY},{token_id:i[1],side:l.Side.BUY}]),n=parseFloat(t?.[i[0]]||"0"),a=parseFloat(t?.[i[1]]||"0");if(n>.9)return"up";if(a>.9)return"down"}catch{}return"pending"}catch{return"pending"}}function h(e){let t=Math.floor(Date.now()/1e3),n=900*Math.floor(t/900),i=[],a=e&&e.length>0?e.map(e=>I[e]):Object.values(I);for(let e=1;e<=10;e++){let t=n-900*e;for(let e of a){let n=`${e}-updown-15m-${t}`,a=T.get(n);if(a){i.push(a);break}}}return i}function w(e){f(e).catch(e=>{o.k.error(`[Scanner] Initial scan failed: ${e}`)}),setInterval(()=>{f(e).catch(e=>{o.k.error(`[Scanner] Scan failed: ${e}`)})},3e4),setInterval(()=>{g(e).catch(e=>{o.k.error(`[Scanner] Price poll failed: ${e}`)})},1e3),o.k.info(`[Scanner] Started for assets: ${e.join(", ")}`)}function $(e,t){let n=T.get(e);if(n)n.result=t;else{let n=parseInt(e.split("-").pop()||"0",10),i=new Date((n+900)*1e3);T.set(e,{slug:e,timestamp:n,result:t,endTime:i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})}}function y(){let e=Math.floor(Date.now()/1e3);return Array.from(A.values()).map(t=>{let n=parseInt(t.slug.split("-").pop()||"0",10);return{...t,secondsRemaining:Math.max(0,n+900-e)}})}function k(e){return A.get(e)||null}i()}catch(e){i(e)}})}};