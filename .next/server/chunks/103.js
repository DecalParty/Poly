"use strict";exports.id=103,exports.ids=[103],exports.modules={58134:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{A2:()=>u,CR:()=>l,PD:()=>c,r8:()=>d,tS:()=>$});var r=n(21925),a=n(3412),s=n(43895),o=e([r]);r=(o.then?(await o)():o)[0];let y=null,w={windowsPlayed:0,bothSidesFilled:0,oneSideFilled:0,neitherFilled:0,totalPnl:0,avgProfitPerWindow:0},k=null,P=0,I=30,b=()=>{},E=()=>{},A=()=>{};function l(e,t,n){b=e,E=t,A=n}function d(){if(!y)return null;let e=Math.floor(Date.now()/1e3);return y.secondsRemaining=Math.max(0,y.endTime-e),m(),{...y}}function c(){return{...w}}async function u(e,t,n){if(!e.arbEnabled)return;let i=t.find(t=>t.asset===e.arbMarket);if(!i)return;let r=Math.floor(Date.now()/1e3),a=900*Math.floor(r/900),s=`${e.arbMarket.toLowerCase()}-arb-${a}`,o=a+900-r;if(y&&y.windowId!==s&&(await h(y,n),y=null,k=null),y&&o<=e.arbCancelBeforeEnd&&"active"===y.status&&(await S(y,n),y.status="cancelling",E(`[ARB] Cancelled unfilled orders -- ${o}s before resolution`)),!(o<=e.arbCancelBeforeEnd)){if(k===s){n&&y&&"active"===y.status&&function(e,t){let n=t.yesPrice,i=t.noPrice,r=!1;for(let t of e.upSide.orders)if(("placed"===t.status||"partial"===t.status)&&n<=t.price+.02){let e=n<=t.price?1:.3,i=t.targetSize*e;i>t.filledSize&&(t.filledSize=i,t.status=t.filledSize>=t.targetSize?"filled":"partial",r=!0)}for(let t of e.downSide.orders)if(("placed"===t.status||"partial"===t.status)&&i<=t.price+.02){let e=i<=t.price?1:.3,n=t.targetSize*e;n>t.filledSize&&(t.filledSize=n,t.status=t.filledSize>=t.targetSize?"filled":"partial",r=!0)}r&&(g(e.upSide),g(e.downSide),m())}(y,i),!n&&y&&"active"===y.status&&await f(y);return}if(I<e.arbMaxPerWindow)return;await p(e,i,s,a,n)}}async function p(e,t,n,i,a){let o=null!=e.arbBudgetUp&&e.arbBudgetUp>0?e.arbBudgetUp:e.arbMaxPerWindow/2,l=null!=e.arbBudgetDown&&e.arbBudgetDown>0?e.arbBudgetDown:e.arbMaxPerWindow/2,d=[],c=[];for(let u of e.arbLadderLevels){let e=o*u.allocation,p=l*u.allocation,f=e/u.price,g=p/u.price,m={side:"yes",price:u.price,targetSize:f,filledSize:0,orderId:null,status:"pending"},S={side:"no",price:u.price,targetSize:g,filledSize:0,orderId:null,status:"pending"};if(a)m.orderId=`paper-up-${u.price}-${i}`,m.status="placed",S.orderId=`paper-down-${u.price}-${i}`,S.status="placed";else{let[e,n]=await Promise.all([(0,r.pQ)(t.yesTokenId,u.price,f,t.tickSize,t.negRisk),(0,r.pQ)(t.noTokenId,u.price,g,t.tickSize,t.negRisk)]);e.success&&e.orderId&&(m.orderId=e.orderId,m.status="placed"),n.success&&n.orderId&&(S.orderId=n.orderId,S.status="placed")}d.push(m),c.push(S),s.k.info(`[ARB] Limit order: UP $${u.price} x ${f.toFixed(2)} shares | DOWN $${u.price} x ${g.toFixed(2)} shares | window=${n}`)}I-=e.arbMaxPerWindow,P=e.arbMaxPerWindow,y={windowId:n,conditionId:t.conditionId,slug:t.slug,asset:e.arbMarket,startTime:i,endTime:i+900,secondsRemaining:i+900-Math.floor(Date.now()/1e3),upSide:{totalShares:0,totalCost:0,avgPrice:0,orders:d},downSide:{totalShares:0,totalCost:0,avgPrice:0,orders:c},combinedCost:0,guaranteedPnl:0,status:"active",resolution:"pending",pnl:null},k=n,w.windowsPlayed++,E(`[ARB] Placed ${2*e.arbLadderLevels.length} limit orders for ${n}`),A("info",`Arb: Placed ladder orders for ${e.arbMarket}`,e.arbMarket)}async function f(e){let t=!1;for(let n of[...e.upSide.orders,...e.downSide.orders])if(("placed"===n.status||"partial"===n.status)&&n.orderId){let e=await (0,r.SX)(n.orderId);if(!e)continue;let i=String(e.status||"").toUpperCase();e.sizeFilled>n.filledSize&&(n.filledSize=e.sizeFilled,"MATCHED"===i||"CLOSED"===i||"FILLED"===i?n.status="filled":e.sizeFilled>0&&(n.status="partial"),t=!0),("CANCELLED"===i||"EXPIRED"===i||"REJECTED"===i)&&(n.status="cancelled",t=!0)}t&&(g(e.upSide),g(e.downSide),m())}function g(e){let t=0,n=0;for(let i of e.orders)t+=i.filledSize,n+=i.filledSize*i.price;e.totalShares=t,e.totalCost=n,e.avgPrice=t>0?n/t:0}function m(){if(!y)return;let e=y.upSide,t=y.downSide;if(e.avgPrice>0&&t.avgPrice>0){y.combinedCost=e.avgPrice+t.avgPrice;let n=Math.min(e.totalShares,t.totalShares);y.guaranteedPnl=n*(1-y.combinedCost)}else e.avgPrice>0||t.avgPrice>0?y.combinedCost=e.avgPrice+t.avgPrice:y.combinedCost=0,y.guaranteedPnl=0}async function S(e,t){let n=[];for(let i of[...e.upSide.orders,...e.downSide.orders])("placed"===i.status||"partial"===i.status)&&i.orderId&&(t||n.push(i.orderId),i.status="cancelled");n.length>0&&!t&&await (0,r._e)(n),g(e.upSide),g(e.downSide),m(),s.k.info(`[ARB] Cancelled ${n.length} unfilled orders | UP: ${e.upSide.totalShares.toFixed(2)} shares | DOWN: ${e.downSide.totalShares.toFixed(2)} shares | Combined: $${e.combinedCost.toFixed(3)}`)}async function h(e,t){"active"===e.status&&await S(e,t),e.status="resolved";let n=e.upSide.totalShares,i=e.downSide.totalShares,r=e.upSide.totalCost,o=e.downSide.totalCost,l=r+o,d=n>0&&i>0,c=n>0!=i>0;if(d?w.bothSidesFilled++:c?w.oneSideFilled++:w.neitherFilled++,0===l){I=Math.min(30,I+P),E(`[ARB] Window ${e.windowId} -- no fills, capital returned`);return}if(n>0){let i=(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:"yes",action:"buy",price:e.upSide.avgPrice,amount:r,shares:n,pnl:null,paper:t,orderId:null,asset:e.asset,subStrategy:"arbitrage",binancePriceAtEntry:null,slippage:null,takerFee:0});b(i)}if(i>0){let n=(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:"no",action:"buy",price:e.downSide.avgPrice,amount:o,shares:i,pnl:null,paper:t,orderId:null,asset:e.asset,subStrategy:"arbitrage",binancePriceAtEntry:null,slippage:null,takerFee:0});b(n)}if(t&&l>0){let t=Math.random()>.5,s=t?1*n:0,d=t?0:1*i,c=s+d,u=c-l;if(e.resolution=t?"up":"down",e.pnl=u,n>0){let i=(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:"yes",action:"resolution",price:t?1:0,amount:s,shares:n,pnl:s-r,paper:!0,orderId:null,asset:e.asset,subStrategy:"arbitrage",binancePriceAtEntry:null,slippage:null,takerFee:null});b(i)}if(i>0){let n=(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:"no",action:"resolution",price:t?0:1,amount:d,shares:i,pnl:d-o,paper:!0,orderId:null,asset:e.asset,subStrategy:"arbitrage",binancePriceAtEntry:null,slippage:null,takerFee:null});b(n)}w.totalPnl+=u,w.bothSidesFilled+w.oneSideFilled>0&&(w.avgProfitPerWindow=w.totalPnl/(w.bothSidesFilled+w.oneSideFilled)),I=Math.min(30,I+c),E(`[ARB] ${u>=0?"WIN":"LOSS"} Window resolved ${t?"UP":"DOWN"} | Invested: $${l.toFixed(2)} | Payout: $${c.toFixed(2)} | P&L: $${u.toFixed(2)}`),A(u>=0?"success":"warning",`Arb ${t?"UP":"DOWN"}: P&L $${u.toFixed(2)} (invested $${l.toFixed(2)})`,e.asset)}else I=Math.min(30,I+l);s.k.info(`[ARB] Window summary: ${e.windowId} | UP: ${n.toFixed(2)} @ $${e.upSide.avgPrice.toFixed(3)} | DOWN: ${i.toFixed(2)} @ $${e.downSide.avgPrice.toFixed(3)} | Combined: $${e.combinedCost.toFixed(3)} | P&L: ${null!==e.pnl?"$"+e.pnl.toFixed(2):"pending"}`)}function $(){return y?y.upSide.totalCost+y.downSide.totalCost:0}i()}catch(e){i(e)}})},57103:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{BU:()=>y,ap:()=>h,hC:()=>x,xS:()=>T,y0:()=>A,zX:()=>D});var r=n(97320),a=n(35239),s=n(69376),o=n(58134),l=n(3412),d=n(24979),c=n(21925),u=n(47152),p=n(90399),f=n(12792),g=n(43895),m=e([r,s,o,d,c]);[r,s,o,d,c]=m.then?(await m)():m;let v="stopped",F="disconnected",B="Idle",L=null,O=null,R=null,H=null,_=new Map,N=new Map,z=new Map,U=[],W=!1,Y=null,G=null,J=[],j=0,V=null,X=null,K=null,q=null,Q=0;function S(){let e=Date.now();return(!q||e-Q>2e3)&&(q=(0,l.Gw)(),Q=e),q}function h(){q=null,Q=0}let Z=!1,ee=null,et=null,en=0,ei={},er=new Set,ea=!1;function $(){if(ea)return;ea=!0;let e=S();(0,d.up)(e.enabledAssets),g.k.info("[Engine] Auto-started market scanner for dashboard")}let es="";function y(e){return $(),function(){if(K)return;let e=0;K=setInterval(()=>{if(0===er.size)return;let t=S(),n={};for(let e of(0,d.$2)())n[e.asset]=e;0===Object.keys(n).length?(e++,(5===e||e%30==0)&&(g.k.warn(`[Engine] No active markets found after ${e} broadcast cycles - Polymarket API may be unreachable from this server`),I("No market data - Polymarket API may be unreachable from this server. Check logs for details."))):e=0;let i=(0,d.bp)(t.enabledAssets),r=JSON.stringify(i),a=r!==es;a&&(es=r),w({type:"price",data:{markets:n,...a?{recentOutcomes:i}:{}},timestamp:new Date().toISOString()})},1e3)}(),er.add(e),e({type:"state",data:A(),timestamp:new Date().toISOString()}),()=>er.delete(e)}function w(e){for(let t of er)try{t(e)}catch{er.delete(t)}}function k(){w({type:"state",data:A(),timestamp:new Date().toISOString()})}function P(e){w({type:"trade",data:e,timestamp:new Date().toISOString()})}function I(e){w({type:"log",data:{message:e},timestamp:new Date().toISOString()})}function b(e,t,n){let i={id:`alert-${++j}`,timestamp:new Date().toISOString(),severity:e,message:t,asset:n};J.unshift(i),J.length>100&&(J.length=100),w({type:"alert",data:i,timestamp:i.timestamp})}function E(e){let t=0;for(let e of _.values())t+=e.costBasis;let n=(0,o.tS)();t+=n;let i=(0,l._l)(),r=(0,l.uF)(),a=(0,l.vs)();return{totalBankroll:e.totalBankroll,deployed:t,available:Math.max(0,e.maxTotalExposure-t),maxExposure:e.maxTotalExposure,todayPnl:i,winStreak:a,totalLosses:r}}function A(){let e;let t=S(),n=(0,r.pi)();!function(){let e=Date.now();if(e-en<3e4)return;en=e;let t=process.env.PRIVATE_KEY,n=process.env.FUNDER_ADDRESS;if(t)try{let e=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",i=new p.StaticJsonRpcProvider(e,137),r=new u.Wallet(t,i);et=n||r.address;let a=["function balanceOf(address) view returns (uint256)"],s=new f.Contract("0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",a,i),o=new f.Contract("0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359",a,i),l=[];n&&l.push(n),n&&n.toLowerCase()===r.address.toLowerCase()||l.push(r.address),Promise.all(l.flatMap(e=>[s.balanceOf(e).then(e=>Number(e)/1e6).catch(()=>0),o.balanceOf(e).then(e=>Number(e)/1e6).catch(()=>0)])).then(e=>{let t=e.reduce((e,t)=>e+t,0);ee=t,Z?(0,c.tS)().then(e=>{e&&e.getBalanceAllowance({asset_type:"COLLATERAL"}).then(e=>{let n=e?.balance||"0",i=parseFloat(n),r=i>1e6?i/1e6:i;ee=t+r,g.k.info(`[Wallet] on-chain=$${t.toFixed(2)} exchange=$${r.toFixed(2)} raw="${n}" addresses=${l.join(",")}`)}).catch(()=>{})}).catch(()=>{}):g.k.info(`[Wallet] on-chain=$${t.toFixed(2)} (balances: ${e.map(e=>e.toFixed(2)).join(", ")}) addresses=${l.join(",")}`)}).catch(()=>{})}catch{}}();let i=!1;O?R?n>t.highConfTimeMax?e=`${(n/60).toFixed(1)}m remaining (need <= ${Math.floor(t.highConfTimeMax/60)}m)`:R.leadingPrice<t.highConfEntryMin||R.leadingPrice>t.highConfEntryMax?e=`Price $${R.leadingPrice.toFixed(4)} outside range $${t.highConfEntryMin}-$${t.highConfEntryMax}`:i=!0:e="Waiting for price data":e="No active market found";let a={market:O,prices:R,secondsRemaining:n,eligible:i,ineligibleReason:e},s={};for(let e of(0,d.$2)())s[e.asset]=e;let m={};for(let[e,t]of _)m[e]=t;return{status:v,connection:F,lastAction:B,lastActionTime:L,currentMarket:a,currentPosition:H,settings:t,cumulativePnl:(0,l.NW)(),totalTrades:(0,l.yW)(),activeMarkets:s,positions:m,capital:E(t),circuitBreaker:{triggered:W,reason:Y,resumeAt:G,dailyPnl:(0,l._l)(),totalLosses:(0,l.uF)()},clobReady:Z,alerts:J.slice(0,50),arbState:(0,o.r8)(),arbStats:(0,o.PD)(),walletBalance:ee,walletAddress:et}}async function C(){try{F="connecting";let e=await (0,r.ri)();if(e){O&&O.conditionId!==e.conditionId&&g.k.info(`Market rotated: ${O.slug} -> ${e.slug}`),O=e,N.set(e.conditionId,e),F="connected";let t=await (0,r.pw)(e);t&&(R=t,H&&(H.currentPrice="yes"===H.side?t.yesPrice:t.noPrice,H.unrealizedPnl=H.shares*H.currentPrice-H.costBasis))}else O=null,R=null,F="connected"}catch(t){F="disconnected";let e=[t?.message?`message=${t.message}`:null,t?.code?`code=${t.code}`:null,t?.name?`name=${t.name}`:null,t?.response?.status?`status=${t.response.status}`:null,t?.config?.url?`url=${t.config.url}`:null].filter(Boolean).join(" ");g.k.error(`Market refresh failed${e?` (${e})`:""}`),I(`Connection error${e?`: ${e}`:""}`)}k()}let eo=!1;async function M(){if("running"===v&&!eo){eo=!0;try{let e=S();if(function(e){if(W){if(G){let e=new Date(G).getTime();if(Date.now()>=e)return W=!1,Y=null,G=null,b("info","Circuit breaker cooldown ended. Bot resumed."),!1}return!0}let t=(0,l._l)();if(t<-e.dailyLossLimit)return W=!0,Y=`Daily loss $${Math.abs(t).toFixed(2)} exceeded limit $${e.dailyLossLimit}`,G=new Date(Date.now()+144e5).toISOString(),b("error",`Circuit breaker triggered: ${Y}. Pausing for 4 hours.`),!0;let n=(0,l.uF)();return n>=e.lossLimit&&(W=!0,Y=`${n} losses today (limit: ${e.lossLimit})`,b("error",`Circuit breaker triggered: ${Y}. Bot stopped.`),!0)}(e)){k();return}let t=(0,d.$2)();if(0===t.length){let e=Date.now(),t=ei._noMarkets;(!t||e-t.time>=15e3)&&(ei._noMarkets={reason:"no markets",time:e},I("Scanning for active 15-minute markets..."))}for(let n of t){if(!e.enabledAssets.includes(n.asset))continue;let t=`${n.asset}-${n.conditionId}`,i=_.get(t)||null;if(!i&&_.size>=e.maxSimultaneousPositions)continue;let r=(0,a.k)(e,n,null,i);switch(r.action){case"buy":{if(!r.side||!r.price)break;let a=i?i.side:r.side,o="yes"===a?n.yesPrice:n.noPrice,l=e.highConfBuyAmount,d=Math.max(0,e.maxTotalExposure-E(e).deployed);if((l=Math.min(l,e.perWindowMax-(i?.costBasis??0),d))<=0||i&&i.costBasis>=e.perWindowMax)break;let{trade:c,error:u}=await (0,s.P4)(n.market,a,o,l,e.paperTrading,i?{conditionId:i.marketId,side:i.side,shares:i.shares,avgEntryPrice:i.avgEntryPrice,costBasis:i.costBasis,currentPrice:i.currentPrice,unrealizedPnl:i.unrealizedPnl}:null,{asset:n.asset,subStrategy:"highConfidence",expectedPrice:o});c?(i?(i.shares+=c.shares,i.costBasis+=c.amount,i.avgEntryPrice=i.costBasis/i.shares,i.lastBuyTime=Date.now()):(_.set(t,{marketId:n.conditionId,slug:n.slug,asset:n.asset,side:a,shares:c.shares,avgEntryPrice:o,currentPrice:o,unrealizedPnl:0,entryTime:new Date().toISOString(),hedged:!1,costBasis:c.amount,subStrategy:"highConfidence",lastBuyTime:Date.now()}),N.set(n.conditionId,n.market),"BTC"===n.asset&&(H={conditionId:n.conditionId,side:a,shares:c.shares,avgEntryPrice:o,costBasis:c.amount,currentPrice:o,unrealizedPnl:0})),B=`Buy ${n.asset} ${a} @ $${o.toFixed(4)}`,L=new Date().toISOString(),P(c),b("info",`Buy: ${n.asset} ${a.toUpperCase()} @ $${o.toFixed(4)}`,n.asset)):u&&I(`Buy failed (${n.asset}): ${u}`),I(r.reason);break}case"sell":{if(!i||!r.price||!r.side)break;let{trade:a,error:o}=await (0,s.dI)(n.market,{conditionId:i.marketId,side:i.side,shares:i.shares,avgEntryPrice:i.avgEntryPrice,costBasis:i.costBasis,currentPrice:i.currentPrice,unrealizedPnl:i.unrealizedPnl},r.price,e.paperTrading,{asset:n.asset});a?(B=`Sold ${n.asset} ${i.side} @ $${r.price.toFixed(4)}`,L=new Date().toISOString(),_.delete(t),"BTC"===n.asset&&(H=null),P(a),b("warning",`Sold: ${n.asset} @ $${r.price.toFixed(4)} | P&L: $${a.pnl?.toFixed(4)}`,n.asset)):o&&I(`Sell failed (${n.asset}): ${o}`),I(r.reason);break}case"hold":case"wait":{let e=Date.now(),t=ei[n.asset],i=!t||t.reason!==r.reason,a=!t||e-t.time>=15e3;(i||a)&&(ei[n.asset]={reason:r.reason,time:e},I(r.reason))}}}try{await (0,o.A2)(e,t,e.paperTrading)}catch(e){g.k.error(`[ARB] Tick error: ${e}`)}for(let[t,n]of Array.from(_.entries())){let i=(0,d.rs)(n.asset),a=parseInt(n.slug.split("-").pop()||"0",10),o=Math.max(0,a+900-Math.floor(Date.now()/1e3)),l=i&&i.conditionId!==n.marketId,c=o<=0;if(!l&&!c)continue;let u=z.get(t)||0;if(Date.now()-u<5e3)continue;z.set(t,Date.now());let p=N.get(n.marketId);if(!p){g.k.warn(`[Resolution] No cached MarketInfo for ${t}, cannot resolve`);continue}let f=await (0,r.r_)(n.slug);if(null===f&&(f=await (0,r.P_)(p)),null===f){g.k.debug(`[Resolution] ${t} not resolved yet, will retry`);continue}let m={conditionId:n.marketId,side:n.side,shares:n.shares,avgEntryPrice:n.avgEntryPrice,costBasis:n.costBasis,currentPrice:n.currentPrice,unrealizedPnl:n.unrealizedPnl},S=(0,s.Kb)(p,m,f,e.paperTrading,{asset:n.asset}),h=n.side===f;(0,d.E3)(n.slug,"yes"===f?"up":"down"),_.delete(t),z.delete(t),"BTC"===n.asset&&(H=null),P(S),I(`${n.asset} resolved ${"yes"===f?"UP":"DOWN"} - ${h?"WON":"LOST"} | P&L: $${S.pnl?.toFixed(4)}`),b(h?"success":"warning",`${n.asset} resolved ${"yes"===f?"UP":"DOWN"}: ${h?"WON":"LOST"} ($${S.pnl?.toFixed(4)})`,n.asset),!e.paperTrading&&h&&(U.push({conditionId:p.conditionId,negRisk:p.negRisk,asset:n.asset,attempts:0,nextAttempt:Date.now()+5e3}),I(`${n.asset} queued for auto-claim (will retry until on-chain is ready)`))}for(let[,e]of _){let t=(0,d.rs)(e.asset);t&&(e.currentPrice="yes"===e.side?t.yesPrice:t.noPrice,e.unrealizedPnl=e.shares*e.currentPrice-e.costBasis)}let n=Date.now();for(let e=U.length-1;e>=0;e--){let t=U[e];if(!(n<t.nextAttempt)){t.attempts++;try{let i=await (0,c.fA)(t.conditionId,t.negRisk);i.success?(I(`${t.asset} winnings claimed on-chain (attempt ${t.attempts})`),b("success",`Claimed winnings for ${t.asset}`,t.asset),U.splice(e,1)):(g.k.info(`[Redeem] ${t.asset} attempt ${t.attempts}/20: ${i.error}`),t.attempts>=20?(I(`${t.asset} auto-claim gave up after ${t.attempts} attempts: ${i.error}`),b("warning",`Auto-claim failed for ${t.asset} � claim manually on polymarket.com`,t.asset),U.splice(e,1)):t.nextAttempt=n+3e4)}catch(i){g.k.error(`[Redeem] ${t.asset} attempt ${t.attempts} error: ${i}`),t.attempts>=20?U.splice(e,1):t.nextAttempt=n+3e4}}}}catch(e){g.k.error(`Trading loop error: ${e}`),I(`Error: ${e}`)}finally{eo=!1}k()}}async function D(){if("running"===v)return{success:!1,error:"Bot is already running"};g.k.info("Starting bot..."),v="running",B="Bot started",L=new Date().toISOString(),(0,o.CR)(e=>P(e),e=>I(e),(e,t,n)=>b(e,t,n));let e=S();if($(),b("info",`Market scanner active for: ${e.enabledAssets.join(", ")}`),e.paperTrading)Z=!1,b("info","Paper mode - CLOB client not needed");else{try{(Z=!!await (0,c.tS)())?b("success","CLOB client connected - live trading ready"):b("error","CLOB client failed - check PRIVATE_KEY and FUNDER_ADDRESS in .env.local")}catch{Z=!1,b("error","CLOB client initialization failed")}k()}if(!e.paperTrading)try{let e=(0,l.V3)(4);if(e.length>0){for(let t of(g.k.info(`[Redeem] Found ${e.length} recent winning trade(s) to check for unclaimed tokens`),e))U.some(e=>e.conditionId===t.conditionId)||U.push({conditionId:t.conditionId,negRisk:!0,asset:t.asset,attempts:0,nextAttempt:Date.now()+3e3});I(`Queued ${e.length} recent win(s) for auto-claim`)}}catch(e){g.k.error(`[Redeem] Startup claim scan failed: ${e}`)}return C(),V=setInterval(M,1e3),X=setInterval(C,3e4),k(),I("Bot started"),b("success","Bot started successfully"),{success:!0}}function x(){return"stopped"===v?{success:!1,error:"Bot is already stopped"}:(g.k.info("Stopping bot..."),V&&(clearInterval(V),V=null),X&&(clearInterval(X),X=null),v="stopped",Z=!1,h(),B="Bot stopped",L=new Date().toISOString(),k(),I("Bot stopped"),b("info","Bot stopped"),{success:!0})}function T(){return W=!1,Y=null,G=null,b("info","Circuit breaker manually reset"),k(),{success:!0}}i()}catch(e){i(e)}})},69376:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{Kb:()=>u,P4:()=>d,dI:()=>c});var r=n(21925),a=n(3412),s=n(43895),o=e([r]);function l(e,t){let n=t*(1-t);return .25*e*n*n}async function d(e,t,n,i,o,d,c={}){let u=i/n,p="yes"===t?e.yesTokenId:e.noTokenId,f=l(u,n),g=c.expectedPrice?Math.abs(n-c.expectedPrice)/c.expectedPrice:0;if(o)return s.k.info(`[PAPER] BUY ${u.toFixed(4)} ${t} @ $${n.toFixed(4)} ($${i}) | Asset: ${c.asset||"?"} | Strategy: ${c.subStrategy||"?"} | Fee: $${f.toFixed(6)}`),{trade:(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:t,action:"buy",price:n,amount:i,shares:u,pnl:null,paper:!0,orderId:null,asset:c.asset||null,subStrategy:c.subStrategy||null,binancePriceAtEntry:null,slippage:g,takerFee:f})};s.k.info(`[LIVE] Placing BUY: ${u.toFixed(4)} ${t} @ $${n.toFixed(4)} ($${i})`);let m=await (0,r.L4)(p,n,u,e.tickSize,e.negRisk);if(!m.success)return s.k.error(`Buy order failed: ${m.error}`),{trade:null,error:m.error};let S=m.filledSize??u,h=m.filledPrice??n,$=S*h,y=l(S,h),w=c.expectedPrice?Math.abs(h-c.expectedPrice)/c.expectedPrice:g;return{trade:(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:t,action:"buy",price:h,amount:$,shares:S,pnl:null,paper:!1,orderId:m.orderId||null,asset:c.asset||null,subStrategy:c.subStrategy||null,binancePriceAtEntry:null,slippage:w,takerFee:y})}}async function c(e,t,n,i,o={}){let d="yes"===t.side?e.yesTokenId:e.noTokenId,c=t.shares*n,u=c-t.costBasis,p=l(t.shares,n);if(i)return s.k.info(`[PAPER] SELL ${t.shares.toFixed(4)} ${t.side} @ $${n.toFixed(4)} | P&L: $${u.toFixed(4)}`),{trade:(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:t.side,action:"sell",price:n,amount:c,shares:t.shares,pnl:u,paper:!0,orderId:null,asset:o.asset||null,subStrategy:o.subStrategy||null,binancePriceAtEntry:null,slippage:null,takerFee:p})};s.k.info(`[LIVE] Placing SELL: ${t.shares.toFixed(4)} ${t.side} @ $${n.toFixed(4)}`);let f=await (0,r.EG)(d,n,t.shares,e.tickSize,e.negRisk);if(!f.success)return s.k.error(`Sell order failed: ${f.error}`),{trade:null,error:f.error};let g=f.filledSize??t.shares,m=f.filledPrice??n,S=g*m,h=S-t.costBasis,$=l(g,m);return{trade:(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:t.side,action:"sell",price:m,amount:S,shares:g,pnl:h,paper:!1,orderId:f.orderId||null,asset:o.asset||null,subStrategy:o.subStrategy||null,binancePriceAtEntry:null,slippage:null,takerFee:$})}}function u(e,t,n,i,r={}){let o=t.side===n,l=o?t.shares:0,d=l-t.costBasis;return s.k.info(`[${i?"PAPER":"LIVE"}] RESOLUTION: ${o?"WON":"LOST"} | ${t.shares.toFixed(4)} shares | Payout: $${l.toFixed(4)} | P&L: $${d.toFixed(4)}`),(0,a.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:t.side,action:"resolution",price:"yes"===n?1:0,amount:l,shares:t.shares,pnl:d,paper:i,orderId:null,asset:r.asset||null,subStrategy:r.subStrategy||null,binancePriceAtEntry:null,slippage:null,takerFee:null})}r=(o.then?(await o)():o)[0],i()}catch(e){i(e)}})},35239:(e,t,n)=>{n.d(t,{k:()=>i});function i(e,t,n,i){let r=t.secondsRemaining,a=t.yesPrice,s=t.noPrice;if(!e.highConfEnabled)return{action:"wait",reason:"High-confidence strategy disabled"};let o=a>=s?"yes":"no",l="yes"===o?a:s;if(i&&i.shares>0){if(r>=e.highConfTimeMin&&r<=e.highConfTimeMax&&l>=e.highConfEntryMin&&l<=e.highConfEntryMax&&o===i.side){let n=Date.now(),r=1e3*e.highConfBuyInterval;if(!i.lastBuyTime||n-i.lastBuyTime>=r)return{action:"buy",reason:`DCA: ${t.asset} ${i.side.toUpperCase()} @ $${l.toFixed(4)} � every ${e.highConfBuyInterval}s � $${i.costBasis.toFixed(2)} deployed`,side:i.side,price:l}}return{action:"hold",reason:`Holding ${i.side.toUpperCase()} @ $${i.avgEntryPrice.toFixed(4)} � ${i.shares.toFixed(2)} shares � $${i.costBasis.toFixed(2)}`}}return r<e.highConfTimeMin?{action:"wait",reason:`Window closing in ${r}s � no new entries`}:r>e.highConfTimeMax?{action:"wait",reason:`${t.asset}: ${Math.floor(r/60)}m left � waiting for ?${Math.floor(e.highConfTimeMax/60)}m`}:l>=e.highConfEntryMin&&l<=e.highConfEntryMax?{action:"buy",reason:`Entry: ${t.asset} ${o.toUpperCase()} @ $${l.toFixed(4)} (${Math.floor(r/60)}m left)`,side:o,price:l}:{action:"wait",reason:`${t.asset}: $${l.toFixed(4)} outside range $${e.highConfEntryMin}�$${e.highConfEntryMax}`}}},97320:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{P_:()=>S,pi:()=>u,pw:()=>h,r_:()=>m,ri:()=>f});var r=n(35240),a=n.n(r),s=n(67332),o=n(21925),l=n(43895),d=e([s,o]);async function c(e,t,n=3){for(let i=0;i<n;i++)try{return await function(e,t){let n=new URLSearchParams(t).toString(),i=`${e}?${n}`;return new Promise((e,t)=>{let n=a().get({hostname:"gamma-api.polymarket.com",path:i,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"},ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",ecdhCurve:"prime256v1:secp384r1",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",timeout:1e4},n=>{if(n.statusCode&&n.statusCode>=400){let e=Error(`${n.statusCode} ${n.statusMessage}`);e.status=n.statusCode,n.resume(),t(e);return}let i="";n.on("data",e=>i+=e),n.on("end",()=>{try{e(JSON.parse(i))}catch(e){t(e)}})});n.on("error",t),n.on("timeout",()=>{n.destroy(),t(Error("timeout"))})})}(e,t)}catch(s){if(i===n-1)throw s;let r=s.status;if(r&&r>=400&&r<500&&429!==r)throw s;let a=Math.min(1e3*Math.pow(2,i),8e3);l.k.warn(`[Markets] ${e}?${new URLSearchParams(t)} failed (attempt ${i+1}/${n}), retrying in ${a}ms`),await new Promise(e=>setTimeout(e,a))}throw Error("Unreachable")}function u(){let e=Math.floor(Date.now()/1e3);return(Math.floor(e/900)+1)*900-e}async function p(e){try{let t=await c("/markets",{slug:e});if(!t||!Array.isArray(t)||0===t.length)return l.k.debug(`No market found for slug: ${e}`),null;let n=t[0],i=n.clobTokenIds?"string"==typeof n.clobTokenIds?JSON.parse(n.clobTokenIds):n.clobTokenIds:[];if(i.length<2)return l.k.warn(`Market ${e} has insufficient token IDs`),null;return{conditionId:n.conditionId,slug:n.slug||e,question:n.question||"BTC 15m candle",yesTokenId:i[0],noTokenId:i[1],endDate:n.endDate||n.endDateIso||"",endTimestamp:n.endDate?new Date(n.endDate).getTime()/1e3:0,active:!1!==n.active&&!n.closed,tickSize:n.orderPriceMinTickSize||"0.01",negRisk:!0===n.negRisk}}catch(t){if(404===t.status)return null;return l.k.error(`Error fetching market ${e}: ${t.message||t}`),null}}async function f(){let e=function(){let e=Math.floor(Date.now()/1e3);return`btc-updown-15m-${900*Math.floor(e/900)}`}(),t=await p(e);if(t&&t.active)return t;let n=Math.floor(Date.now()/1e3),i=`btc-updown-15m-${(Math.floor(n/900)-1)*900}`;return(t=await p(i))&&t.active?t:null}async function g(e){try{let t=(0,o.YX)(),[n,i]=await Promise.all([t.getOrderBook(e.yesTokenId).catch(()=>null),t.getOrderBook(e.noTokenId).catch(()=>null)]),r=.5,a=.5;n&&(n.asks&&n.asks.length>0?r=parseFloat(n.asks[0].price):n.last_trade_price&&(r=parseFloat(n.last_trade_price))),i&&(i.asks&&i.asks.length>0?a=parseFloat(i.asks[0].price):i.last_trade_price&&(a=parseFloat(i.last_trade_price))),r>0&&.5===a?a=Math.max(.01,1-r):a>0&&.5===r&&(r=Math.max(.01,1-a));let s=r>=a?"yes":"no",l="yes"===s?r:a;return{yesPrice:r,noPrice:a,leadingSide:s,leadingPrice:l,timestamp:Date.now()}}catch(e){return l.k.error(`Error fetching prices: ${e}`),null}}async function m(e){try{let t=await c("/markets",{slug:e});if(!t||!Array.isArray(t)||0===t.length)return l.k.debug(`[Resolution] No market found for slug: ${e}`),null;let n=t[0];if(!0===n.active&&!n.closed)return l.k.debug(`[Resolution] ${e} still active (active=${n.active}, closed=${n.closed})`),null;if(n.outcomePrices){let t;if("string"==typeof n.outcomePrices)try{let e=JSON.parse(n.outcomePrices);t=Array.isArray(e)?e.map(Number):n.outcomePrices.split(",").map(Number)}catch{t=n.outcomePrices.split(",").map(Number)}else{if(!Array.isArray(n.outcomePrices))return l.k.debug(`[Resolution] ${e} unexpected outcomePrices type: ${typeof n.outcomePrices}`),null;t=n.outcomePrices.map(Number)}if(t.length>=2&&!t.some(isNaN)){if(t[0]>t[1])return l.k.info(`[Resolution] ${e} resolved YES/UP (prices: ${t})`),"yes";if(t[1]>t[0])return l.k.info(`[Resolution] ${e} resolved NO/DOWN (prices: ${t})`),"no"}l.k.debug(`[Resolution] ${e} outcomePrices inconclusive: ${JSON.stringify(t)}`)}else l.k.debug(`[Resolution] ${e} closed but no outcomePrices (active=${n.active}, closed=${n.closed})`);return null}catch(t){return l.k.error(`[Resolution] Failed to fetch ${e}: ${t}`),null}}async function S(e){try{let t=(0,o.YX)(),n=await t.getMidpoints([{token_id:e.yesTokenId,side:s.Side.BUY},{token_id:e.noTokenId,side:s.Side.BUY}]),i=parseFloat(n?.[e.yesTokenId]||"0"),r=parseFloat(n?.[e.noTokenId]||"0");if(l.k.debug(`[Resolution CLOB] ${e.slug} YES=${i} NO=${r}`),i>.9)return"yes";if(r>.9)return"no";return null}catch(t){return l.k.debug(`[Resolution CLOB] Failed for ${e.slug}: ${t}`),null}}async function h(e){try{let t=(0,o.YX)(),n=await t.getMidpoints([{token_id:e.yesTokenId,side:s.Side.BUY},{token_id:e.noTokenId,side:s.Side.BUY}]),i=parseFloat(n?.[e.yesTokenId]||"0.5"),r=parseFloat(n?.[e.noTokenId]||"0.5"),a=i>=r?"yes":"no";return{yesPrice:i,noPrice:r,leadingSide:a,leadingPrice:"yes"===a?i:r,timestamp:Date.now()}}catch{return g(e)}}[s,o]=d.then?(await d)():d,i()}catch(e){i(e)}})},24979:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{$2:()=>w,E3:()=>y,bp:()=>h,rs:()=>k,up:()=>$});var r=n(35240),a=n.n(r),s=n(21925),o=n(43895),l=n(67332),d=e([s,l]);async function c(e,t,n=3){for(let i=0;i<n;i++)try{return await function(e,t){let n=new URLSearchParams(t).toString(),i=`${e}?${n}`;return new Promise((e,t)=>{let n=a().get({hostname:"gamma-api.polymarket.com",path:i,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"},ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",ecdhCurve:"prime256v1:secp384r1",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",timeout:1e4},n=>{if(n.statusCode&&n.statusCode>=400){let e=Error(`${n.statusCode} ${n.statusMessage}`);e.status=n.statusCode,n.resume(),t(e);return}let i="";n.on("data",e=>i+=e),n.on("end",()=>{try{e(JSON.parse(i))}catch(e){t(e)}})});n.on("error",t),n.on("timeout",()=>{n.destroy(),t(Error("timeout"))})})}(e,t)}catch(s){if(i===n-1)throw s;let r=s.status;if(r&&r>=400&&r<500&&429!==r)throw s;let a=Math.min(1e3*Math.pow(2,i),8e3);o.k.warn(`[Scanner] ${e}?${new URLSearchParams(t)} failed (attempt ${i+1}/${n}), retrying in ${a}ms`),await new Promise(e=>setTimeout(e,a))}throw Error("Unreachable")}[s,l]=d.then?(await d)():d;let P={BTC:"btc",ETH:"eth",SOL:"sol",XRP:"xrp"},I=new Map,b=new Map,E=new Map,A=0,C=[];function u(e){let t=Math.floor(Date.now()/1e3);return Math.max(0,e+900-t)}async function p(e,t){let n=`${P[e]}-updown-15m-${t}`;try{let i=await c("/markets",{slug:n});if(!i||!Array.isArray(i)||0===i.length)return null;let r=i[0],a=r.clobTokenIds?"string"==typeof r.clobTokenIds?JSON.parse(r.clobTokenIds):r.clobTokenIds:[];if(a.length<2)return null;return{conditionId:r.conditionId,slug:r.slug||n,question:r.question||`${e} 15m candle`,yesTokenId:a[0],noTokenId:a[1],endDate:r.endDate||r.endDateIso||"",endTimestamp:r.endDate?new Date(r.endDate).getTime()/1e3:t+900,active:!1!==r.active&&!r.closed,tickSize:r.orderPriceMinTickSize||"0.01",negRisk:!0===r.negRisk,asset:e}}catch(n){return o.k.error(`[Scanner] fetchMarket(${e}, ${t}) failed: ${n.message||n}`),null}}async function f(e){let{current:t,prev:n}=function(){let e=Math.floor(Date.now()/1e3),t=900*Math.floor(e/900);return{current:t,prev:t-900}}();await Promise.all(e.map(async e=>{let i=b.get(e);if(!i||i.windowTs!==t)for(let i of[t,n]){let n=await p(e,i);if(n&&n.active){b.set(e,{market:n,windowTs:t});break}}})),await g(e);let i=Date.now(),r=JSON.stringify(e)!==JSON.stringify(C);(i-A>5e3||r)&&(A=i,C=[...e],m(e).catch(()=>{}))}async function g(e){let t=[],n=[];for(let i of e){let e=b.get(i);if(!e)continue;let{market:r}=e;r.active&&(0>=u(parseInt(r.slug.split("-").pop()||"0",10))||(t.push({asset:i,market:r}),n.push({token_id:r.yesTokenId,side:l.Side.BUY},{token_id:r.noTokenId,side:l.Side.BUY})))}if(0!==n.length)try{let e=(0,s.YX)(),i=await e.getMidpoints(n);for(let{asset:e,market:n}of t){let t=parseFloat(i?.[n.yesTokenId]||"0.5"),r=parseFloat(i?.[n.noTokenId]||"0.5"),a=parseInt(n.slug.split("-").pop()||"0",10),s=u(a);if(s>0){let i={asset:e,conditionId:n.conditionId,slug:n.slug,yesTokenId:n.yesTokenId,noTokenId:n.noTokenId,yesPrice:t,noPrice:r,combinedCost:t+r,secondsRemaining:s,market:n,tickSize:n.tickSize,negRisk:n.negRisk};I.set(e,i)}}}catch(t){let e=t instanceof Error?t.message:String(t);o.k.warn(`[Scanner] Batched price poll failed: ${e}`)}}async function m(e){let t=Math.floor(Date.now()/1e3),n=900*Math.floor(t/900),i=[];for(let t of e){let e=P[t];for(let t=1;t<=10;t++){let r=n-900*t,a=`${e}-updown-15m-${r}`,s=E.get(a);s&&"pending"!==s.result||i.push((async()=>{try{let e=await S(a),t=new Date((r+900)*1e3);E.set(a,{slug:a,timestamp:r,result:e,endTime:t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})}catch{}})())}}await Promise.all(i)}async function S(e){try{let t=await c("/markets",{slug:e},2);if(!t?.[0])return"pending";let n=t[0];if(!0===n.active&&!n.closed)return"pending";if(n.outcomePrices)try{let e;if("string"==typeof n.outcomePrices)try{let t=JSON.parse(n.outcomePrices);e=Array.isArray(t)?t.map(Number):n.outcomePrices.split(",").map(Number)}catch{e=n.outcomePrices.split(",").map(Number)}else e=Array.isArray(n.outcomePrices)?n.outcomePrices.map(Number):[];if(e.length>=2&&!e.some(isNaN)){if(e[0]>e[1])return"up";if(e[1]>e[0])return"down"}}catch{}let i=n.clobTokenIds?"string"==typeof n.clobTokenIds?JSON.parse(n.clobTokenIds):n.clobTokenIds:[];if(i.length>=2)try{let e=(0,s.YX)(),t=await e.getMidpoints([{token_id:i[0],side:l.Side.BUY},{token_id:i[1],side:l.Side.BUY}]),n=parseFloat(t?.[i[0]]||"0"),r=parseFloat(t?.[i[1]]||"0");if(n>.9)return"up";if(r>.9)return"down"}catch{}return"pending"}catch{return"pending"}}function h(e){let t=Math.floor(Date.now()/1e3),n=900*Math.floor(t/900),i=[],r=e&&e.length>0?e.map(e=>P[e]):Object.values(P);for(let e=1;e<=10;e++){let t=n-900*e;for(let e of r){let n=`${e}-updown-15m-${t}`,r=E.get(n);if(r){i.push(r);break}}}return i}function $(e){f(e).catch(e=>{o.k.error(`[Scanner] Initial scan failed: ${e}`)}),setInterval(()=>{f(e).catch(e=>{o.k.error(`[Scanner] Scan failed: ${e}`)})},3e4),setInterval(()=>{g(e).catch(e=>{o.k.error(`[Scanner] Price poll failed: ${e}`)})},1e3),o.k.info(`[Scanner] Started for assets: ${e.join(", ")}`)}function y(e,t){let n=E.get(e);if(n)n.result=t;else{let n=parseInt(e.split("-").pop()||"0",10),i=new Date((n+900)*1e3);E.set(e,{slug:e,timestamp:n,result:t,endTime:i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})}}function w(){let e=Math.floor(Date.now()/1e3);return Array.from(I.values()).map(t=>{let n=parseInt(t.slug.split("-").pop()||"0",10);return{...t,secondsRemaining:Math.max(0,n+900-e)}})}function k(e){return I.get(e)||null}i()}catch(e){i(e)}})}};