"use strict";exports.id=103,exports.ids=[103],exports.modules={57103:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{BU:()=>y,ap:()=>h,hC:()=>D,xS:()=>F,y0:()=>b,zX:()=>x});var r=n(97320),a=n(9854),s=n(3412),o=n(24979),l=n(21925),c=n(91162),d=n(47152),u=n(90399),p=n(12792),f=n(43895),g=e([r,o,l,c]);[r,o,l,c]=g.then?(await g)():g;let M="stopped",v="disconnected",O="Idle",B=null,L=null,R=null,_=new Map,H=new Map,U=[],N=[],z=[],W=0,Y=0,G=0,V=!1,J=null,X=null,q=[],j=0,K=null,Z=null,Q=null,ee=null,et=0;function m(){let e=Date.now();return(!ee||e-et>2e3)&&(ee=(0,s.Gw)(),et=e),ee}function h(){ee=null,et=0}let en=!1,ei=null,er=null,ea=0,es={},eo=new Set,el=!1;function $(){if(el)return;el=!0;let e=m();(0,o.up)(e.enabledAssets),f.k.info("[Engine] Auto-started market scanner for dashboard")}let ec="";function S(e){let t="yes"===e.side?o.rs(e.asset)?.yesPrice??e.entryPrice:o.rs(e.asset)?.noPrice??e.entryPrice;return{id:e.id,conditionId:e.conditionId,slug:e.slug,asset:e.asset,side:e.side,entryPrice:e.entryPrice,shares:e.shares,costBasis:e.costBasis,currentPrice:t,sellPrice:e.sellPrice,sellOrderId:e.sellOrderId,buyOrderId:e.buyOrderId,entryTime:e.entryTime,windowEndTs:e.windowEndTs,unrealizedPnl:e.shares*t-e.costBasis}}function w(e){return{orderId:e.orderId,conditionId:e.conditionId,slug:e.slug,asset:e.asset,side:e.side,price:e.price,size:e.size,placedAt:e.placedAt}}function y(e){return $(),function(){if(Q)return;let e=0;Q=setInterval(()=>{if(0===eo.size)return;let t=m(),n={};for(let e of(0,o.$2)())n[e.asset]=e;0===Object.keys(n).length?(e++,(5===e||e%30==0)&&f.k.warn(`[Engine] No active markets found after ${e} broadcast cycles`)):e=0;let i=(0,o.bp)(t.enabledAssets),r=JSON.stringify(i),s=r!==ec;s&&(ec=r);let l=(0,c.zk)(),d=Object.values(n).find(e=>"BTC"===e.asset),u=d?.yesPrice??.5,p=d?.noPrice??.5,g=(0,c.ZV)(3e4),h=(0,c.VI)(18e5),$=d?.secondsRemaining??450,y=(0,a.vT)(u,p,g,(0,c.iS)(),h.direction,h.strength,$);I({type:"price",data:{markets:n,...s?{recentOutcomes:i}:{},scalp:{binancePrice:(0,c.iS)(),windowOpenPrice:(0,c.as)(),btcChangePercent:l,fairValue:y,positions:N.map(S),pendingBuys:z.map(w),cooldownUntil:0}},timestamp:new Date().toISOString()})},1e3)}(),(0,c.md)(),eo.add(e),e({type:"state",data:b(),timestamp:new Date().toISOString()}),()=>eo.delete(e)}function I(e){for(let t of eo)try{t(e)}catch{eo.delete(t)}}function k(){I({type:"state",data:b(),timestamp:new Date().toISOString()})}function P(e){I({type:"log",data:{message:e},timestamp:new Date().toISOString()})}function E(e,t,n){let i={id:`alert-${++j}`,timestamp:new Date().toISOString(),severity:e,message:t,asset:n};q.unshift(i),q.length>100&&(q.length=100),I({type:"alert",data:i,timestamp:i.timestamp})}function A(e){let t=0;for(let e of N)t+=e.costBasis;for(let e of z)t+=e.price*e.size;let n=(0,s._l)(),i=(0,s.uF)(),r=(0,s.vs)();return{totalBankroll:e.maxTotalExposure,deployed:t,available:Math.max(0,e.maxTotalExposure-t),maxExposure:e.maxTotalExposure,todayPnl:n,winStreak:r,totalLosses:i}}function b(){let e;let t=m(),n=(0,r.pi)();!function(){let e=Date.now();if(e-ea<3e4)return;ea=e;let t=process.env.PRIVATE_KEY,n=process.env.FUNDER_ADDRESS;if(t)try{let e=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com",i=new u.StaticJsonRpcProvider(e,137),r=new d.Wallet(t,i);er=n||r.address;let a=["function balanceOf(address) view returns (uint256)"],s=new p.Contract("0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",a,i),o=new p.Contract("0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359",a,i),c=[];n&&c.push(n),n&&n.toLowerCase()===r.address.toLowerCase()||c.push(r.address),Promise.all(c.flatMap(e=>[s.balanceOf(e).then(e=>Number(e)/1e6).catch(()=>0),o.balanceOf(e).then(e=>Number(e)/1e6).catch(()=>0)])).then(e=>{let t=e.reduce((e,t)=>e+t,0);ei=t,en&&(0,l.tS)().then(e=>{e&&e.getBalanceAllowance({asset_type:"COLLATERAL"}).then(e=>{let n=e?.balance||"0",i=parseFloat(n);ei=t+(i>1e6?i/1e6:i)}).catch(()=>{})}).catch(()=>{})}).catch(()=>{})}catch{}}();let i=!1;L?R?i=!0:e="Waiting for price data":e="No active market found";let f={market:L,prices:R,secondsRemaining:n,eligible:i,ineligibleReason:e},g={};for(let e of(0,o.$2)())g[e.asset]=e;let h={};for(let[e,t]of _)h[e]=t;let $=(0,c.zk)(),y=(0,o.$2)(),I=y.length>0?y[0].secondsRemaining:450,k=y.find(e=>"BTC"===e.asset),P=k?.yesPrice??.5,E=k?.noPrice??.5,b=(0,c.ZV)(3e4),T=(0,c.VI)(18e5),C=(0,a.vT)(P,E,b,(0,c.iS)(),T.direction,T.strength,I);return{status:M,connection:v,lastAction:O,lastActionTime:B,currentMarket:f,currentPosition:null,settings:t,cumulativePnl:(0,s.NW)(),totalTrades:(0,s.yW)(),activeMarkets:g,positions:h,capital:A(t),circuitBreaker:{triggered:V,reason:J,resumeAt:X,dailyPnl:(0,s._l)(),totalLosses:(0,s.uF)()},clobReady:en,alerts:q.slice(0,50),arbState:null,arbStats:{windowsPlayed:0,bothSidesFilled:0,oneSideFilled:0,neitherFilled:0,totalPnl:0,avgProfitPerWindow:0},walletBalance:ei,walletAddress:er,scalp:{binancePrice:(0,c.iS)(),windowOpenPrice:(0,c.as)(),btcChangePercent:$,fairValue:C,positions:N.map(S),pendingBuys:z.map(w),cooldownUntil:0}}}async function T(){try{v="connecting";let e=await (0,r.ri)();if(e){L&&L.conditionId!==e.conditionId&&f.k.info(`Market rotated: ${L.slug} -> ${e.slug}`),L=e,H.set(e.conditionId,e),v="connected";let t=await (0,r.pw)(e);t&&(R=t)}else L=null,R=null,v="connected"}catch(e){v="disconnected",f.k.error(`Market refresh failed: ${e?.message||e}`)}k()}let ed=!1;async function C(){if("running"===M&&!ed){ed=!0;try{let t=m();if(function(e){if(V){if(X){let e=new Date(X).getTime();if(Date.now()>=e)return V=!1,J=null,X=null,E("info","Circuit breaker cooldown ended. Bot resumed."),!1}return!0}let t=(0,s._l)();if(t<-e.dailyLossLimit)return V=!0,J=`Daily loss $${Math.abs(t).toFixed(2)} exceeded limit $${e.dailyLossLimit}`,X=new Date(Date.now()+144e5).toISOString(),E("error",`Circuit breaker triggered: ${J}. Pausing for 4 hours.`),!0;let n=(0,s.uF)();return n>=e.lossLimit&&(V=!0,J=`${n} losses today (limit: ${e.lossLimit})`,E("error",`Circuit breaker triggered: ${J}. Bot stopped.`),!0)}(t)){k();return}if(!t.scalpEnabled){ed=!1;return}let n=(0,o.$2)(),i=Date.now(),d=(0,c.zk)(),u=(0,c.cs)();for(let n=z.length-1;n>=0;n--){let r=z[n],a=1e3*r.windowEndTs;if(i>a){try{await (0,l.sl)(r.orderId)}catch{}f.k.info(`[SCALP] Cancelled expired buy order ${r.orderId}`),z.splice(n,1);continue}let d=await (0,l.SX)(r.orderId);if(!d)continue;let u=d.status.toUpperCase();if("MATCHED"===u||"CLOSED"===u||"FILLED"===u){if(d.sizeFilled>0){var e;let a=d.price||r.price,u=d.sizeFilled,p=u*a,f=Math.min(.99,Math.round((a+t.scalpProfitTarget)*100)/100);e=(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:r.conditionId,slug:r.slug,side:r.side,action:"buy",price:a,amount:p,shares:u,pnl:null,paper:t.paperTrading,orderId:r.orderId,asset:r.asset,subStrategy:"scalp",binancePriceAtEntry:(0,c.iS)(),slippage:null,takerFee:0}),I({type:"trade",data:e,timestamp:new Date().toISOString()});let g=null;if(!t.paperTrading){let e=await (0,l.eE)(r.tokenId,f,u,r.tickSize,r.negRisk);e.success&&e.orderId&&(g=e.orderId)}let m=`scalp-${r.conditionId.slice(0,8)}-${Date.now()}`;N.push({id:m,conditionId:r.conditionId,slug:r.slug,asset:r.asset,side:r.side,tokenId:r.tokenId,entryPrice:a,shares:u,costBasis:p,sellPrice:f,sellOrderId:g,buyOrderId:r.orderId,entryTime:i,windowEndTs:r.windowEndTs}),O=`Scalp buy ${r.asset} ${r.side.toUpperCase()} @ $${a.toFixed(2)}`,B=new Date().toISOString(),P(`Scalp entry: ${r.side.toUpperCase()} ${u.toFixed(1)} shares @ $${a.toFixed(2)}, sell target $${f.toFixed(2)}`),E("info",`Scalp buy: ${r.side.toUpperCase()} @ $${a.toFixed(2)}`,r.asset),z.splice(n,1),H.set(r.conditionId,o.rs(r.asset)?.market)}}else if("CANCELLED"===u||"EXPIRED"===u||"REJECTED"===u)P(`Buy order ${u}: ${r.side.toUpperCase()} ${r.asset} @ $${r.price.toFixed(2)} (${r.orderId.slice(0,12)}...)`),E("warning",`Order ${u.toLowerCase()}: ${r.side.toUpperCase()} @ $${r.price.toFixed(2)}`,r.asset),z.splice(n,1);else{let e=i-r.placedAt;e>1e4&&e%15e3<1100&&P(`Order still open: ${r.side.toUpperCase()} @ $${r.price.toFixed(2)} (${Math.round(e/1e3)}s)`)}}for(let e=N.length-1;e>=0;e--){let n=N[e],c=(0,o.rs)(n.asset),u=c?"yes"===n.side?c.yesPrice:c.noPrice:n.entryPrice,p=n.windowEndTs,f=Math.max(0,p+900-Math.floor(i/1e3));if(n.sellOrderId&&!t.paperTrading){let t=await (0,l.SX)(n.sellOrderId);if(t){let r=t.status.toUpperCase();if(("MATCHED"===r||"CLOSED"===r||"FILLED"===r)&&t.sizeFilled>0){let r=t.price||n.sellPrice,a=n.shares*r-n.costBasis;(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:n.conditionId,slug:n.slug,side:n.side,action:"sell",price:r,amount:n.shares*r,shares:n.shares,pnl:a,paper:!1,orderId:n.sellOrderId,asset:n.asset,subStrategy:"scalp",binancePriceAtEntry:null,slippage:null,takerFee:0}),P(`Scalp exit: ${n.side.toUpperCase()} @ $${r.toFixed(2)} | P&L: $${a.toFixed(4)}`),E(a>=0?"success":"warning",`Scalp sold @ $${r.toFixed(2)} | P&L: $${a.toFixed(4)}`,n.asset),O=`Scalp sold ${n.asset} @ $${r.toFixed(2)}`,B=new Date().toISOString(),Y=i,G=0,N.splice(e,1);continue}}}else if(t.paperTrading&&u>=n.sellPrice){let t=n.shares*n.sellPrice-n.costBasis;(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:n.conditionId,slug:n.slug,side:n.side,action:"sell",price:n.sellPrice,amount:n.shares*n.sellPrice,shares:n.shares,pnl:t,paper:!0,orderId:null,asset:n.asset,subStrategy:"scalp",binancePriceAtEntry:null,slippage:null,takerFee:0}),P(`[PAPER] Scalp profit: ${n.side.toUpperCase()} @ $${n.sellPrice.toFixed(2)} | P&L: $${t.toFixed(4)}`),E("success",`Scalp sold @ $${n.sellPrice.toFixed(2)} | +$${t.toFixed(4)}`,n.asset),O=`Scalp sold ${n.asset} @ $${n.sellPrice.toFixed(2)}`,B=new Date().toISOString(),N.splice(e,1);continue}let g=(0,a.S2)(n.entryPrice,n.sellPrice,u,d,n.side,f,t.scalpProfitTarget,t.scalpExitWindow);if("trail"===g.action&&g.sellPrice&&g.sellPrice>n.sellPrice){if(n.sellOrderId&&!t.paperTrading)try{await (0,l.sl)(n.sellOrderId)}catch{}let e=g.sellPrice,i=null;if(!t.paperTrading&&c){let t=await (0,l.eE)(n.tokenId,e,n.shares,c.tickSize,c.negRisk);t.success&&t.orderId&&(i=t.orderId)}n.sellPrice=e,n.sellOrderId=i,P(`Trail sell: ${n.side.toUpperCase()} $${n.sellPrice.toFixed(2)}`)}else if("sell_profit"===g.action||"sell_loss"===g.action){if(n.sellOrderId&&!t.paperTrading)try{await (0,l.sl)(n.sellOrderId)}catch{}let r=g.sellPrice||u,a=n.shares*r-n.costBasis;!t.paperTrading&&c&&await (0,l.EG)(n.tokenId,r,n.shares,c.tickSize,c.negRisk),(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:n.conditionId,slug:n.slug,side:n.side,action:"sell",price:r,amount:n.shares*r,shares:n.shares,pnl:a,paper:t.paperTrading,orderId:null,asset:n.asset,subStrategy:"scalp",binancePriceAtEntry:null,slippage:null,takerFee:0}),P(`${"sell_profit"===g.action?"Profit exit":"Exit window"}: ${n.side.toUpperCase()} @ $${r.toFixed(2)} | P&L: $${a.toFixed(4)}`),E(a>=0?"success":"warning",`Scalp ${a>=0?"profit":"exit"} @ $${r.toFixed(2)}`,n.asset),Y=i,G=0,N.splice(e,1);continue}else"hold_resolution"===g.action&&P(g.reason);if(f<=0){let a=H.get(n.conditionId);if(a){let c=await (0,r.r_)(n.slug);if(null===c&&(c=await (0,r.P_)(a)),null!==c){let r=n.side===c,d=r?1:0,u=n.shares*d-n.costBasis;if(n.sellOrderId&&!t.paperTrading)try{await (0,l.sl)(n.sellOrderId)}catch{}(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:n.conditionId,slug:n.slug,side:n.side,action:"resolution",price:d,amount:n.shares*d,shares:n.shares,pnl:u,paper:t.paperTrading,orderId:null,asset:n.asset,subStrategy:"scalp",binancePriceAtEntry:null,slippage:null,takerFee:null}),(0,o.E3)(n.slug,"yes"===c?"up":"down"),P(`Resolution: ${n.side.toUpperCase()} ${r?"WON":"LOST"} | P&L: $${u.toFixed(4)}`),E(r?"success":"warning",`Resolved ${r?"WON":"LOST"}: $${u.toFixed(4)}`,n.asset),!t.paperTrading&&r&&U.push({conditionId:a.conditionId,negRisk:a.negRisk,asset:n.asset,attempts:0,nextAttempt:i+5e3}),N.splice(e,1)}}}}if(i-W>=500){if(W=i,u)for(let e of n){if(!t.enabledAssets.includes(e.asset))continue;let n=N.filter(t=>t.conditionId===e.conditionId).length,r=z.filter(t=>t.conditionId===e.conditionId).length;if(n+r>=t.scalpMaxPositions)continue;let o=A(t),d=e.secondsRemaining<=t.scalpHalfSizeAfter?t.scalpTradeSize/2:t.scalpTradeSize;if(o.available<d)continue;let u=(0,c.ZV)(3e4),p=(0,c.ZV)(5e3),f=(0,c.iS)(),g=(0,c.VI)(18e5),m=(0,a.XE)(e.yesPrice,e.noPrice,u,p,f,g.direction,g.strength,e.secondsRemaining,t.scalpMinGap,t.scalpEntryMin,t.scalpEntryMax,t.scalpExitWindow,Y,G),h=(0,a.vT)(e.yesPrice,e.noPrice,u,f,g.direction,g.strength,e.secondsRemaining);G=Math.max(h.up-e.yesPrice,h.down-e.noPrice);let $=`_diag_${e.asset}`,S=es[$];if(!S||i-S.time>=15e3){es[$]={reason:"diag",time:i};let t=Math.floor(e.secondsRemaining/60),n=e.secondsRemaining%60,r=(u/30).toFixed(1),a=(p/5).toFixed(1),s=g.direction>0?"UP":g.direction<0?"DN":"--",o=Y>0?Math.max(0,15-Math.round((i-Y)/1e3)):0;P(`[${e.asset}] ${t}:${n.toString().padStart(2,"0")} | BTC $${f.toFixed(0)} v30=$${r} v5=$${a} ${s}${(100*g.strength).toFixed(0)}% | UP $${e.yesPrice.toFixed(2)} fair $${h.up.toFixed(3)} | DN $${e.noPrice.toFixed(2)} fair $${h.down.toFixed(3)} | gap ${(100*G).toFixed(1)}c${o>0?` | CD ${o}s`:""}`)}if(m){let n="yes"===m.side?e.yesTokenId:e.noTokenId,r=Math.floor(d/m.actualPrice*100)/100,a=parseInt(e.slug.split("-").pop()||"0",10);if(t.paperTrading){let o=`scalp-paper-${Date.now()}`,l=Math.min(.99,Math.round((m.actualPrice+t.scalpProfitTarget)*100)/100);(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:m.side,action:"buy",price:m.actualPrice,amount:d,shares:r,pnl:null,paper:!0,orderId:o,asset:e.asset,subStrategy:"scalp",binancePriceAtEntry:(0,c.iS)(),slippage:null,takerFee:0}),N.push({id:o,conditionId:e.conditionId,slug:e.slug,asset:e.asset,side:m.side,tokenId:n,entryPrice:m.actualPrice,shares:r,costBasis:d,sellPrice:l,sellOrderId:null,buyOrderId:o,entryTime:i,windowEndTs:a}),H.set(e.conditionId,e.market),P(`[PAPER] Scalp entry: ${m.reason} | sell target $${l.toFixed(2)}`),E("info",`Scalp buy: ${m.side.toUpperCase()} @ $${m.actualPrice.toFixed(2)}`,e.asset)}else{let o=await (0,l.L4)(n,m.actualPrice,r,e.tickSize,e.negRisk);if(o.success&&o.orderId){let l=o.filledPrice||m.actualPrice,d=o.filledSize||r,u=Math.min(.99,Math.round((l+t.scalpProfitTarget)*100)/100);N.push({id:o.orderId,conditionId:e.conditionId,slug:e.slug,asset:e.asset,side:m.side,tokenId:n,entryPrice:l,shares:d,costBasis:d*l,sellPrice:u,sellOrderId:null,buyOrderId:o.orderId,entryTime:i,windowEndTs:a}),H.set(e.conditionId,e.market),(0,s.Ei)({timestamp:new Date().toISOString(),conditionId:e.conditionId,slug:e.slug,side:m.side,action:"buy",price:l,amount:d*l,shares:d,pnl:null,paper:!1,orderId:o.orderId,asset:e.asset,subStrategy:"scalp",binancePriceAtEntry:(0,c.iS)(),slippage:l-m.actualPrice,takerFee:0}),P(`Market buy FILLED: ${m.side.toUpperCase()} ${d.toFixed(1)} @ $${l.toFixed(2)} | target $${u.toFixed(2)}`),E("info",`Scalp buy: ${m.side.toUpperCase()} @ $${l.toFixed(2)}`,e.asset)}else P(`Market buy FAILED: ${o.error||"unknown"} | ${m.side.toUpperCase()} ${r} @ $${m.actualPrice.toFixed(2)}`),E("warning",`Buy failed: ${o.error||"unknown"}`,e.asset)}O=`Scalp signal: ${m.side.toUpperCase()} @ $${m.actualPrice.toFixed(2)}`,B=new Date().toISOString()}}else{let e=es._binance;if(!e||i-e.time>=15e3){es._binance={reason:"no-coinbase",time:i};let e=(0,c.Ih)()>0?Math.round((i-(0,c.Ih)())/1e3):-1;P(`Waiting for Bitbo feed (last update: ${e>=0?e+"s ago":"never"})`)}}}for(let e=U.length-1;e>=0;e--){let t=U[e];if(!(i<t.nextAttempt)){t.attempts++;try{let n=await (0,l.fA)(t.conditionId,t.negRisk);n.success?(P(`${t.asset} winnings claimed on-chain (attempt ${t.attempts})`),E("success",`Claimed winnings for ${t.asset}`,t.asset),U.splice(e,1)):(f.k.info(`[Redeem] ${t.asset} attempt ${t.attempts}/20: ${n.error}`),t.attempts>=20?(E("warning",`Auto-claim failed for ${t.asset}`,t.asset),U.splice(e,1)):t.nextAttempt=i+3e4)}catch(n){f.k.error(`[Redeem] ${t.asset} attempt ${t.attempts} error: ${n}`),t.attempts>=20?U.splice(e,1):t.nextAttempt=i+3e4}}}}catch(e){f.k.error(`Trading loop error: ${e}`),P(`Error: ${e}`)}finally{ed=!1}k()}}async function x(){if("running"===M)return{success:!1,error:"Bot is already running"};f.k.info("Starting bot..."),M="running",O="Bot started",B=new Date().toISOString();let e=m();if($(),(0,c.md)(),E("info",`Market scanner active for: ${e.enabledAssets.join(", ")}`),E("info","Binance BTC price feed connected"),e.paperTrading)en=!1,E("info","Paper mode - CLOB client not needed");else{try{await (0,l.tS)()?(en=!0,E("success","CLOB client ready for live trading")):(en=!1,E("error","CLOB client failed - check PRIVATE_KEY and FUNDER_ADDRESS"))}catch{en=!1,E("error","CLOB client initialization failed")}k()}if(!e.paperTrading)try{let e=await (0,l.A_)();if(e.length>0){let t=0;for(let n of e)!U.some(e=>e.conditionId===n.conditionId)&&(U.push({conditionId:n.conditionId,negRisk:n.negRisk,asset:"BTC",attempts:0,nextAttempt:Date.now()+5e3}),t++);t>0&&P(`Found ${t} claimable position(s) - queued for auto-claim`)}let t=(0,s.JU)(6);if(t.length>0){let{checkProxyTokenBalance:e}=await Promise.resolve().then(n.bind(n,21925)),i=0;for(let n of t)!U.some(e=>e.conditionId===n.conditionId)&&await e(n.conditionId)&&(U.push({conditionId:n.conditionId,negRisk:!0,asset:n.asset,attempts:0,nextAttempt:Date.now()+5e3}),i++);i>0&&P(`DB scan found ${i} additional claimable position(s)`)}0===U.length&&f.k.info("[Redeem] No unclaimed positions found")}catch(e){f.k.error(`[Redeem] Startup claim scan failed: ${e}`)}return T(),K=setInterval(C,1e3),Z=setInterval(T,3e4),k(),P("Bot started - Scalp strategy active"),E("success","Bot started successfully"),{success:!0}}function D(){if("stopped"===M)return{success:!1,error:"Bot is already stopped"};for(let e of(f.k.info("Stopping bot..."),K&&(clearInterval(K),K=null),Z&&(clearInterval(Z),Z=null),z))(0,l.sl)(e.orderId).catch(()=>{});for(let e of N)e.sellOrderId&&(0,l.sl)(e.sellOrderId).catch(()=>{});return z.length=0,M="stopped",en=!1,h(),O="Bot stopped",B=new Date().toISOString(),k(),P("Bot stopped"),E("info","Bot stopped"),{success:!0}}function F(){return V=!1,J=null,X=null,E("info","Circuit breaker manually reset"),k(),{success:!0}}i()}catch(e){i(e)}})},9854:(e,t,n)=>{n.d(t,{S2:()=>s,XE:()=>a,vT:()=>r});let i=[{change:0,value:.5},{change:1e-4,value:.51},{change:2e-4,value:.525},{change:35e-5,value:.55},{change:5e-4,value:.58},{change:75e-5,value:.62},{change:.001,value:.66},{change:.0015,value:.72},{change:.0025,value:.8},{change:.005,value:.9},{change:.01,value:.98}];function r(e,t,n,r,a,s,o){if(r<=0||e<=.01||t<=.01)return{up:e,down:t};let l=Math.sqrt(Math.min(1,Math.max(0,900-o)/900));if(l<.05)return{up:e,down:t};let c=t>e,d=function(e){if(e<=i[0].value)return i[0].change;if(e>=i[i.length-1].value)return i[i.length-1].change;for(let t=1;t<i.length;t++)if(e<=i[t].value){let n=i[t-1],r=i[t],a=(e-n.value)/(r.value-n.value);return n.change+a*(r.change-n.change)}return i[i.length-1].change}(Math.max(.5,Math.min(.97,.5+((c?t:e)-.5)/l))),u=c?r/(1-d):r/(1+d),p=(r+n/30*10-u)/u,f=function(e){if(e<=i[0].change)return i[0].value;if(e>=i[i.length-1].change)return i[i.length-1].value;for(let t=1;t<i.length;t++)if(e<=i[t].change){let n=i[t-1],r=i[t],a=(e-n.change)/(r.change-n.change);return n.value+a*(r.value-n.value)}return i[i.length-1].value}(Math.abs(p)),g=1,m=p>0?1:p<0?-1:0;0!==m&&0!==a&&(g=m===a?1+.3*s:1-.3*s);let h=Math.max(.01,Math.min(.99,.5+(f-.5)*l*g)),$=Math.max(.01,Math.min(.99,1-h));return p>=0?{up:h,down:$}:{up:$,down:h}}function a(e,t,n,i,a,s,o,l,c,d,u,p,f,g){if(a<=0||l<=p)return null;let m=Date.now();if(f>0&&m-f<15e3)return null;let h=n/30;if(.1>Math.abs(h))return null;let $=i/5;if(h>0&&$<-1||h<0&&$>1)return null;let S=r(e,t,n,a,s,o,l),w=S.up-e,y=S.down-t,I=w>=c&&w<=.08&&e>=d&&e<=u,k=y>=c&&y<=.08&&t>=d&&t<=u;if(!I&&!k)return null;let P=s>0?"UP":s<0?"DN":"--";return I&&(!k||w>=y)?{side:"yes",fairValue:S.up,actualPrice:e,gap:w,reason:`UP $${e.toFixed(2)} -> $${S.up.toFixed(2)} (+${(100*w).toFixed(1)}c) v30=$${h.toFixed(1)} v5=$${$.toFixed(1)} ${P}`}:k?{side:"no",fairValue:S.down,actualPrice:t,gap:y,reason:`DN $${t.toFixed(2)} -> $${S.down.toFixed(2)} (+${(100*y).toFixed(1)}c) v30=$${h.toFixed(1)} v5=$${$.toFixed(1)} ${P}`}:null}function s(e,t,n,i,r,a,s,o=120){let l=n-e;return l>=s?{action:"sell_profit",sellPrice:n,reason:`Target hit: $${n.toFixed(2)} = +$${l.toFixed(2)} from entry $${e.toFixed(2)}`}:a<=o?{action:l>=0?"sell_profit":"sell_loss",sellPrice:n,reason:`Exit window: $${n.toFixed(2)}, ${l>=0?"+":""}$${l.toFixed(2)}, ${a}s left`}:{action:"hold",reason:`Holding: $${n.toFixed(2)}, pnl ${l>=0?"+":""}$${l.toFixed(2)}`}}},97320:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{P_:()=>h,pi:()=>u,pw:()=>$,r_:()=>m,ri:()=>f});var r=n(35240),a=n.n(r),s=n(67332),o=n(21925),l=n(43895),c=e([s,o]);async function d(e,t,n=3){for(let i=0;i<n;i++)try{return await function(e,t){let n=new URLSearchParams(t).toString(),i=`${e}?${n}`;return new Promise((e,t)=>{let n=a().get({hostname:"gamma-api.polymarket.com",path:i,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"},ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",ecdhCurve:"prime256v1:secp384r1",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",timeout:1e4},n=>{if(n.statusCode&&n.statusCode>=400){let e=Error(`${n.statusCode} ${n.statusMessage}`);e.status=n.statusCode,n.resume(),t(e);return}let i="";n.on("data",e=>i+=e),n.on("end",()=>{try{e(JSON.parse(i))}catch(e){t(e)}})});n.on("error",t),n.on("timeout",()=>{n.destroy(),t(Error("timeout"))})})}(e,t)}catch(s){if(i===n-1)throw s;let r=s.status;if(r&&r>=400&&r<500&&429!==r)throw s;let a=Math.min(1e3*Math.pow(2,i),8e3);l.k.warn(`[Markets] ${e}?${new URLSearchParams(t)} failed (attempt ${i+1}/${n}), retrying in ${a}ms`),await new Promise(e=>setTimeout(e,a))}throw Error("Unreachable")}function u(){let e=Math.floor(Date.now()/1e3);return(Math.floor(e/900)+1)*900-e}async function p(e){try{let t=await d("/markets",{slug:e});if(!t||!Array.isArray(t)||0===t.length)return l.k.debug(`No market found for slug: ${e}`),null;let n=t[0],i=n.clobTokenIds?"string"==typeof n.clobTokenIds?JSON.parse(n.clobTokenIds):n.clobTokenIds:[];if(i.length<2)return l.k.warn(`Market ${e} has insufficient token IDs`),null;return{conditionId:n.conditionId,slug:n.slug||e,question:n.question||"BTC 15m candle",yesTokenId:i[0],noTokenId:i[1],endDate:n.endDate||n.endDateIso||"",endTimestamp:n.endDate?new Date(n.endDate).getTime()/1e3:0,active:!1!==n.active&&!n.closed,tickSize:n.orderPriceMinTickSize||"0.01",negRisk:!0===n.negRisk}}catch(t){if(404===t.status)return null;return l.k.error(`Error fetching market ${e}: ${t.message||t}`),null}}async function f(){let e=function(){let e=Math.floor(Date.now()/1e3);return`btc-updown-15m-${900*Math.floor(e/900)}`}(),t=await p(e);if(t&&t.active)return t;let n=Math.floor(Date.now()/1e3),i=`btc-updown-15m-${(Math.floor(n/900)-1)*900}`;return(t=await p(i))&&t.active?t:null}async function g(e){try{let t=(0,o.YX)(),[n,i]=await Promise.all([t.getOrderBook(e.yesTokenId).catch(()=>null),t.getOrderBook(e.noTokenId).catch(()=>null)]),r=.5,a=.5;n&&(n.asks&&n.asks.length>0?r=parseFloat(n.asks[0].price):n.last_trade_price&&(r=parseFloat(n.last_trade_price))),i&&(i.asks&&i.asks.length>0?a=parseFloat(i.asks[0].price):i.last_trade_price&&(a=parseFloat(i.last_trade_price))),r>0&&.5===a?a=Math.max(.01,1-r):a>0&&.5===r&&(r=Math.max(.01,1-a));let s=r>=a?"yes":"no",l="yes"===s?r:a;return{yesPrice:r,noPrice:a,leadingSide:s,leadingPrice:l,timestamp:Date.now()}}catch(e){return l.k.error(`Error fetching prices: ${e}`),null}}async function m(e){try{let t=await d("/markets",{slug:e});if(!t||!Array.isArray(t)||0===t.length)return l.k.debug(`[Resolution] No market found for slug: ${e}`),null;let n=t[0];if(!0===n.active&&!n.closed)return l.k.debug(`[Resolution] ${e} still active (active=${n.active}, closed=${n.closed})`),null;if(n.outcomePrices){let t;if("string"==typeof n.outcomePrices)try{let e=JSON.parse(n.outcomePrices);t=Array.isArray(e)?e.map(Number):n.outcomePrices.split(",").map(Number)}catch{t=n.outcomePrices.split(",").map(Number)}else{if(!Array.isArray(n.outcomePrices))return l.k.debug(`[Resolution] ${e} unexpected outcomePrices type: ${typeof n.outcomePrices}`),null;t=n.outcomePrices.map(Number)}if(t.length>=2&&!t.some(isNaN)){if(t[0]>t[1])return l.k.info(`[Resolution] ${e} resolved YES/UP (prices: ${t})`),"yes";if(t[1]>t[0])return l.k.info(`[Resolution] ${e} resolved NO/DOWN (prices: ${t})`),"no"}l.k.debug(`[Resolution] ${e} outcomePrices inconclusive: ${JSON.stringify(t)}`)}else l.k.debug(`[Resolution] ${e} closed but no outcomePrices (active=${n.active}, closed=${n.closed})`);return null}catch(t){return l.k.error(`[Resolution] Failed to fetch ${e}: ${t}`),null}}async function h(e){try{let t=(0,o.YX)(),n=await t.getMidpoints([{token_id:e.yesTokenId,side:s.Side.BUY},{token_id:e.noTokenId,side:s.Side.BUY}]),i=parseFloat(n?.[e.yesTokenId]||"0"),r=parseFloat(n?.[e.noTokenId]||"0");if(l.k.debug(`[Resolution CLOB] ${e.slug} YES=${i} NO=${r}`),i>.9)return"yes";if(r>.9)return"no";return null}catch(t){return l.k.debug(`[Resolution CLOB] Failed for ${e.slug}: ${t}`),null}}async function $(e){try{let t=(0,o.YX)(),n=await t.getMidpoints([{token_id:e.yesTokenId,side:s.Side.BUY},{token_id:e.noTokenId,side:s.Side.BUY}]),i=parseFloat(n?.[e.yesTokenId]||"0.5"),r=parseFloat(n?.[e.noTokenId]||"0.5"),a=i>=r?"yes":"no";return{yesPrice:i,noPrice:r,leadingSide:a,leadingPrice:"yes"===a?i:r,timestamp:Date.now()}}catch{return g(e)}}[s,o]=c.then?(await c)():c,i()}catch(e){i(e)}})},91162:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{Ih:()=>m,VI:()=>y,ZV:()=>w,as:()=>h,cs:()=>S,iS:()=>g,md:()=>f,zk:()=>$});var r=n(89814),a=n(35240),s=n.n(a),o=n(43895),l=e([r]);r=(l.then?(await l)():l)[0];let I=null,k=null,P=0,E=0,A=0,b=0,T=!1,C=[],x=[];function c(){return 900*Math.floor(Date.now()/1e3/900)}async function d(e){return new Promise((t,n)=>{let i=`/api/v3/klines?symbol=BTCUSDT&interval=15m&startTime=${1e3*e}&limit=1`,r=s().get({hostname:"api.binance.com",path:i,timeout:5e3},e=>{let i="";e.on("data",e=>i+=e),e.on("end",()=>{try{let e=JSON.parse(i);if(e&&e.length>0&&e[0][1]){let n=parseFloat(e[0][1]);if(n>0){t(n);return}}n(Error("No kline data"))}catch(e){n(e)}})});r.on("error",n),r.on("timeout",()=>{r.destroy(),n(Error("timeout"))})})}function u(){if(I){try{I.close()}catch{}I=null}try{I=new r.default("wss://api.bitbo.io",{headers:{Origin:"https://bitbo.io"}})}catch(e){o.k.error(`[BitboWS] Failed to create WebSocket: ${e}`),p();return}I.on("open",()=>{o.k.info("[BitboWS] Connected to Bitbo price stream")}),I.on("message",e=>{try{let t=JSON.parse(e.toString());t.market&&"number"==typeof t.market.p&&function(e){if(e<=0)return;P=e,E=Date.now();let t=Date.now();if(0===C.length||t-C[C.length-1].ts>=500)for(C.push({price:e,ts:t});C.length>0&&t-C[0].ts>6e4;)C.shift();if(0===x.length||t-x[x.length-1].ts>=1e4)for(x.push({price:e,ts:t});x.length>0&&t-x[0].ts>54e5;)x.shift();let n=c();n!==b&&(A=e,b=n,o.k.info(`[BitboWS] New window ${n}: provisional open $${e.toFixed(2)}`),d(n).then(e=>{b===n&&(A=e,o.k.info(`[BitboWS] Window ${n}: verified open $${e.toFixed(2)} (Binance)`))}).catch(e=>{o.k.warn(`[BitboWS] Failed to fetch Binance open: ${e.message||e}`)}))}(t.market.p)}catch{}}),I.on("close",()=>{o.k.warn("[BitboWS] Disconnected"),T&&p()}),I.on("error",e=>{o.k.error(`[BitboWS] Error: ${e.message}`)})}function p(){k||(k=setTimeout(()=>{k=null,T&&u()},3e3))}function f(){T||(T=!0,u())}function g(){return P}function m(){return E}function h(){let e=c();return b!==e&&P>0&&(A=P,b=e,d(e).then(t=>{b===e&&(A=t,o.k.info(`[BitboWS] Late-start window ${e}: verified open $${t.toFixed(2)} (Binance)`))}).catch(()=>{})),A}function $(){let e=h();return e<=0||P<=0?0:(P-e)/e}function S(){return E>0&&Date.now()-E<1e4}function w(e=1e4){if(C.length<2)return 0;let t=Date.now()-e,n=null;for(let e of C)if(e.ts>=t){n=e;break}return!n||n.price<=0?0:P-n.price}function y(e=18e5){let t={delta:0,pctChange:0,direction:0,strength:0};if(x.length<3)return t;let n=Date.now()-e,i=null;for(let e of x)if(e.ts>=n){i=e;break}if(!i||i.price<=0)return t;let r=P-i.price,a=r/i.price,s=r>0?1:r<0?-1:0,o=(i.price+P)/2,l=0,c=0;for(let e of x)!(e.ts<n)&&(c++,s>0&&e.price>=o?l++:s<0&&e.price<=o?l++:0===s&&l++);let d=c>0?l/c:0;return{delta:r,pctChange:a,direction:s,strength:d}}i()}catch(e){i(e)}})},24979:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.d(t,{$2:()=>y,E3:()=>w,bp:()=>$,rs:()=>I,up:()=>S});var r=n(35240),a=n.n(r),s=n(21925),o=n(43895),l=n(67332),c=e([s,l]);async function d(e,t,n=3){for(let i=0;i<n;i++)try{return await function(e,t){let n=new URLSearchParams(t).toString(),i=`${e}?${n}`;return new Promise((e,t)=>{let n=a().get({hostname:"gamma-api.polymarket.com",path:i,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"},ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",ecdhCurve:"prime256v1:secp384r1",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",timeout:1e4},n=>{if(n.statusCode&&n.statusCode>=400){let e=Error(`${n.statusCode} ${n.statusMessage}`);e.status=n.statusCode,n.resume(),t(e);return}let i="";n.on("data",e=>i+=e),n.on("end",()=>{try{e(JSON.parse(i))}catch(e){t(e)}})});n.on("error",t),n.on("timeout",()=>{n.destroy(),t(Error("timeout"))})})}(e,t)}catch(s){if(i===n-1)throw s;let r=s.status;if(r&&r>=400&&r<500&&429!==r)throw s;let a=Math.min(1e3*Math.pow(2,i),8e3);o.k.warn(`[Scanner] ${e}?${new URLSearchParams(t)} failed (attempt ${i+1}/${n}), retrying in ${a}ms`),await new Promise(e=>setTimeout(e,a))}throw Error("Unreachable")}[s,l]=c.then?(await c)():c;let k={BTC:"btc",ETH:"eth",SOL:"sol",XRP:"xrp"},P=new Map,E=new Map,A=new Map,b=0,T=[];function u(e){let t=Math.floor(Date.now()/1e3);return Math.max(0,e+900-t)}async function p(e,t){let n=`${k[e]}-updown-15m-${t}`;try{let i=await d("/markets",{slug:n});if(!i||!Array.isArray(i)||0===i.length)return null;let r=i[0],a=r.clobTokenIds?"string"==typeof r.clobTokenIds?JSON.parse(r.clobTokenIds):r.clobTokenIds:[];if(a.length<2)return null;return{conditionId:r.conditionId,slug:r.slug||n,question:r.question||`${e} 15m candle`,yesTokenId:a[0],noTokenId:a[1],endDate:r.endDate||r.endDateIso||"",endTimestamp:r.endDate?new Date(r.endDate).getTime()/1e3:t+900,active:!1!==r.active&&!r.closed,tickSize:r.orderPriceMinTickSize||"0.01",negRisk:!0===r.negRisk,asset:e}}catch(n){return o.k.error(`[Scanner] fetchMarket(${e}, ${t}) failed: ${n.message||n}`),null}}async function f(e){let{current:t,prev:n}=function(){let e=Math.floor(Date.now()/1e3),t=900*Math.floor(e/900);return{current:t,prev:t-900}}();await Promise.all(e.map(async e=>{let i=E.get(e);if(!i||i.windowTs!==t)for(let i of[t,n]){let n=await p(e,i);if(n&&n.active){E.set(e,{market:n,windowTs:t});break}}})),await g(e);let i=Date.now(),r=JSON.stringify(e)!==JSON.stringify(T);(i-b>5e3||r)&&(b=i,T=[...e],m(e).catch(()=>{}))}async function g(e){let t=[],n=[];for(let i of e){let e=E.get(i);if(!e)continue;let{market:r}=e;r.active&&(0>=u(parseInt(r.slug.split("-").pop()||"0",10))||(t.push({asset:i,market:r}),n.push({token_id:r.yesTokenId,side:l.Side.BUY},{token_id:r.noTokenId,side:l.Side.BUY})))}if(0!==n.length)try{let e=(0,s.YX)(),i=await e.getMidpoints(n);for(let{asset:e,market:n}of t){let t=parseFloat(i?.[n.yesTokenId]||"0.5"),r=parseFloat(i?.[n.noTokenId]||"0.5"),a=parseInt(n.slug.split("-").pop()||"0",10),s=u(a);if(s>0){let i={asset:e,conditionId:n.conditionId,slug:n.slug,yesTokenId:n.yesTokenId,noTokenId:n.noTokenId,yesPrice:t,noPrice:r,combinedCost:t+r,secondsRemaining:s,market:n,tickSize:n.tickSize,negRisk:n.negRisk};P.set(e,i)}}}catch(t){let e=t instanceof Error?t.message:String(t);o.k.warn(`[Scanner] Batched price poll failed: ${e}`)}}async function m(e){let t=Math.floor(Date.now()/1e3),n=900*Math.floor(t/900),i=[];for(let t of e){let e=k[t];for(let t=1;t<=10;t++){let r=n-900*t,a=`${e}-updown-15m-${r}`,s=A.get(a);s&&"pending"!==s.result||i.push((async()=>{try{let e=await h(a),t=new Date((r+900)*1e3);A.set(a,{slug:a,timestamp:r,result:e,endTime:t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})}catch{}})())}}await Promise.all(i)}async function h(e){try{let t=await d("/markets",{slug:e},2);if(!t?.[0])return"pending";let n=t[0];if(!0===n.active&&!n.closed)return"pending";if(n.outcomePrices)try{let e;if("string"==typeof n.outcomePrices)try{let t=JSON.parse(n.outcomePrices);e=Array.isArray(t)?t.map(Number):n.outcomePrices.split(",").map(Number)}catch{e=n.outcomePrices.split(",").map(Number)}else e=Array.isArray(n.outcomePrices)?n.outcomePrices.map(Number):[];if(e.length>=2&&!e.some(isNaN)){if(e[0]>e[1])return"up";if(e[1]>e[0])return"down"}}catch{}let i=n.clobTokenIds?"string"==typeof n.clobTokenIds?JSON.parse(n.clobTokenIds):n.clobTokenIds:[];if(i.length>=2)try{let e=(0,s.YX)(),t=await e.getMidpoints([{token_id:i[0],side:l.Side.BUY},{token_id:i[1],side:l.Side.BUY}]),n=parseFloat(t?.[i[0]]||"0"),r=parseFloat(t?.[i[1]]||"0");if(n>.9)return"up";if(r>.9)return"down"}catch{}return"pending"}catch{return"pending"}}function $(e){let t=Math.floor(Date.now()/1e3),n=900*Math.floor(t/900),i=[],r=e&&e.length>0?e.map(e=>k[e]):Object.values(k);for(let e=1;e<=10;e++){let t=n-900*e;for(let e of r){let n=`${e}-updown-15m-${t}`,r=A.get(n);if(r){i.push(r);break}}}return i}function S(e){f(e).catch(e=>{o.k.error(`[Scanner] Initial scan failed: ${e}`)}),setInterval(()=>{f(e).catch(e=>{o.k.error(`[Scanner] Scan failed: ${e}`)})},3e4),setInterval(()=>{g(e).catch(e=>{o.k.error(`[Scanner] Price poll failed: ${e}`)})},1e3),o.k.info(`[Scanner] Started for assets: ${e.join(", ")}`)}function w(e,t){let n=A.get(e);if(n)n.result=t;else{let n=parseInt(e.split("-").pop()||"0",10),i=new Date((n+900)*1e3);A.set(e,{slug:e,timestamp:n,result:t,endTime:i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})}}function y(){let e=Math.floor(Date.now()/1e3);return Array.from(P.values()).map(t=>{let n=parseInt(t.slug.split("-").pop()||"0",10);return{...t,secondsRemaining:Math.max(0,n+900-e)}})}function I(e){return P.get(e)||null}i()}catch(e){i(e)}})}};