"use strict";exports.id=979,exports.ids=[979],exports.modules={43895:(e,t,r)=>{r.d(t,{k:()=>d});var n=r(94624),o=r.n(n),i=r(92048),a=r(55315);let s=process.env.LOG_FILE||(0,a.join)(process.cwd(),"data","bot.log"),c=process.env.LOG_LEVEL||"info",l=(0,a.dirname)(s);(0,i.existsSync)(l)||(0,i.mkdirSync)(l,{recursive:!0});let d=o().createLogger({level:c,format:o().format.combine(o().format.timestamp({format:"YYYY-MM-DD HH:mm:ss.SSS"}),o().format.printf(({timestamp:e,level:t,message:r,...n})=>{let o=Object.keys(n).length?` ${JSON.stringify(n)}`:"";return`[${e}] ${t.toUpperCase()}: ${r}${o}`})),transports:[new(o()).transports.Console({format:o().format.combine(o().format.colorize(),o().format.timestamp({format:"HH:mm:ss"}),o().format.printf(({timestamp:e,level:t,message:r})=>`[${e}] ${t}: ${r}`))}),new(o()).transports.File({filename:s,maxsize:10485760,maxFiles:5})]})},21925:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{EG:()=>A,L4:()=>f,YX:()=>S,_e:()=>E,pQ:()=>m,tS:()=>p});var o=r(67332),i=r(47152),a=r(90399),s=r(99648),c=r(35240),l=r.n(c),d=r(43895),u=e([o,s]);[o,s]=u.then?(await u)():u;let C=new(l()).Agent({ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",keepAlive:!0});s.default.interceptors.request.use(e=>(e.headers["User-Agent"]="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36",e.headers.Accept="application/json, text/plain, */*",e.headers["Accept-Language"]="en-US,en;q=0.9",e.httpAgent=e.httpAgent||C,e.httpsAgent=e.httpsAgent||C,e));let k=null,g=null,h=process.env.POLYGON_RPC_URL||"https://polygon-rpc.com";async function p(){if(k)return k;let e=process.env.PRIVATE_KEY,t=process.env.FUNDER_ADDRESS,r=process.env.CLOB_API_URL||"https://clob.polymarket.com",n=parseInt(process.env.CHAIN_ID||"137"),s=parseInt(process.env.SIGNATURE_TYPE||"0");if(!e||!t)return d.k.warn("No PRIVATE_KEY or FUNDER_ADDRESS set â€” live trading unavailable"),null;try{let c=new a.StaticJsonRpcProvider(h,137),l=new i.Wallet(e,c),u=process.env.CLOB_API_KEY,p=process.env.CLOB_SECRET,S=process.env.CLOB_PASSPHRASE;if(u&&p&&S)g={key:u,secret:p,passphrase:S},d.k.info("Using pre-configured CLOB API keys from .env");else{let e=new o.ClobClient(r,n,l,void 0,s,t);g=await e.createOrDeriveApiKey(),d.k.info("API keys derived from Polymarket")}return k=new o.ClobClient(r,n,l,g,s,t),d.k.info("CLOB client initialized successfully"),k}catch(e){return d.k.error(`Failed to initialize CLOB client: ${e}`),null}}function S(){let e=process.env.CLOB_API_URL||"https://clob.polymarket.com",t=parseInt(process.env.CHAIN_ID||"137");return new o.ClobClient(e,t)}async function f(e,t,r,n,i){let a=await p();if(!a)return{success:!1,error:"CLOB client not initialized"};try{let s=await a.createAndPostOrder({tokenID:e,price:t,side:o.Side.BUY,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:n,negRisk:i});return d.k.info(`Buy order placed: ${r} shares @ $${t} | token=${e}`),{success:!0,orderId:s?.orderID||s?.orderIds?.[0]||"unknown"}}catch(t){let e=t instanceof Error?t.message:String(t);return d.k.error(`Buy order failed: ${e}`),{success:!1,error:e}}}async function A(e,t,r,n,i){let a=await p();if(!a)return{success:!1,error:"CLOB client not initialized"};try{let s=await a.createAndPostOrder({tokenID:e,price:t,side:o.Side.SELL,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:n,negRisk:i});return d.k.info(`Sell order placed: ${r} shares @ $${t} | token=${e}`),{success:!0,orderId:s?.orderID||s?.orderIds?.[0]||"unknown"}}catch(t){let e=t instanceof Error?t.message:String(t);return d.k.error(`Sell order failed: ${e}`),{success:!1,error:e}}}async function m(e,t,r,n,i){let a=await p();if(!a)return{success:!1,error:"CLOB client not initialized"};try{let s=await a.createAndPostOrder({tokenID:e,price:t,side:o.Side.BUY,size:r,feeRateBps:void 0,nonce:void 0,expiration:void 0},{tickSize:n,negRisk:i},o.OrderType.GTC,!1,!0);return d.k.info(`[ARB] Limit buy placed: ${r.toFixed(2)} shares @ $${t} | token=${e}`),{success:!0,orderId:s?.orderID||s?.orderIds?.[0]||"unknown"}}catch(t){let e=t instanceof Error?t.message:String(t);return d.k.error(`[ARB] Limit buy failed: ${e}`),{success:!1,error:e}}}async function E(e){let t=await p();if(!t)return{success:!1,error:"CLOB client not initialized"};try{return await t.cancelOrders(e),d.k.info(`[ARB] Cancelled ${e.length} orders`),{success:!0}}catch(t){let e=t instanceof Error?t.message:String(t);return d.k.error(`[ARB] Batch cancel failed: ${e}`),{success:!1,error:e}}}n()}catch(e){n(e)}})},24979:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{$2:()=>g,E3:()=>k,bp:()=>E,rs:()=>h,up:()=>C});var o=r(35240),i=r.n(o),a=r(21925),s=r(43895),c=r(67332),l=e([a,c]);async function d(e,t,r=3){for(let n=0;n<r;n++)try{return await function(e,t){let r=new URLSearchParams(t).toString(),n=`${e}?${r}`;return new Promise((e,t)=>{let r=i().get({hostname:"gamma-api.polymarket.com",path:n,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"},ciphers:"TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",ecdhCurve:"prime256v1:secp384r1",minVersion:"TLSv1.2",maxVersion:"TLSv1.3",timeout:1e4},r=>{if(r.statusCode&&r.statusCode>=400){let e=Error(`${r.statusCode} ${r.statusMessage}`);e.status=r.statusCode,r.resume(),t(e);return}let n="";r.on("data",e=>n+=e),r.on("end",()=>{try{e(JSON.parse(n))}catch(e){t(e)}})});r.on("error",t),r.on("timeout",()=>{r.destroy(),t(Error("timeout"))})})}(e,t)}catch(a){if(n===r-1)throw a;let o=a.status;if(o&&o>=400&&o<500&&429!==o)throw a;let i=Math.min(1e3*Math.pow(2,n),8e3);s.k.warn(`[Scanner] ${e}?${new URLSearchParams(t)} failed (attempt ${n+1}/${r}), retrying in ${i}ms`),await new Promise(e=>setTimeout(e,i))}throw Error("Unreachable")}[a,c]=l.then?(await l)():l;let y={BTC:"btc",ETH:"eth",SOL:"sol",XRP:"xrp"},w=new Map,H=new Map,I=new Map,D=0,L=[];function u(e){let t=Math.floor(Date.now()/1e3);return Math.max(0,e+900-t)}async function p(e,t){let r=`${y[e]}-updown-15m-${t}`;try{let n=await d("/markets",{slug:r});if(!n||!Array.isArray(n)||0===n.length)return null;let o=n[0],i=o.clobTokenIds?"string"==typeof o.clobTokenIds?JSON.parse(o.clobTokenIds):o.clobTokenIds:[];if(i.length<2)return null;return{conditionId:o.conditionId,slug:o.slug||r,question:o.question||`${e} 15m candle`,yesTokenId:i[0],noTokenId:i[1],endDate:o.endDate||o.endDateIso||"",endTimestamp:o.endDate?new Date(o.endDate).getTime()/1e3:t+900,active:!1!==o.active&&!o.closed,tickSize:o.orderPriceMinTickSize||"0.01",negRisk:!0===o.negRisk,asset:e}}catch(r){return s.k.error(`[Scanner] fetchMarket(${e}, ${t}) failed: ${r.message||r}`),null}}async function S(e){let{current:t,prev:r}=function(){let e=Math.floor(Date.now()/1e3),t=900*Math.floor(e/900);return{current:t,prev:t-900}}();await Promise.all(e.map(async e=>{let n=H.get(e);if(!n||n.windowTs!==t)for(let n of[t,r]){let r=await p(e,n);if(r&&r.active){H.set(e,{market:r,windowTs:t});break}}})),await f(e);let n=Date.now(),o=JSON.stringify(e)!==JSON.stringify(L);(n-D>5e3||o)&&(D=n,L=[...e],A(e).catch(()=>{}))}async function f(e){let t=[],r=[];for(let n of e){let e=H.get(n);if(!e)continue;let{market:o}=e;o.active&&(0>=u(parseInt(o.slug.split("-").pop()||"0",10))||(t.push({asset:n,market:o}),r.push({token_id:o.yesTokenId,side:c.Side.BUY},{token_id:o.noTokenId,side:c.Side.BUY})))}if(0!==r.length)try{let e=(0,a.YX)(),n=await e.getMidpoints(r);for(let{asset:e,market:r}of t){let t=parseFloat(n?.[r.yesTokenId]||"0.5"),o=parseFloat(n?.[r.noTokenId]||"0.5"),i=parseInt(r.slug.split("-").pop()||"0",10),a=u(i);if(a>0){let n={asset:e,conditionId:r.conditionId,slug:r.slug,yesTokenId:r.yesTokenId,noTokenId:r.noTokenId,yesPrice:t,noPrice:o,combinedCost:t+o,secondsRemaining:a,market:r,tickSize:r.tickSize,negRisk:r.negRisk};w.set(e,n)}}}catch(t){let e=t instanceof Error?t.message:String(t);s.k.warn(`[Scanner] Batched price poll failed: ${e}`)}}async function A(e){let t=Math.floor(Date.now()/1e3),r=900*Math.floor(t/900),n=[];for(let t of e){let e=y[t];for(let t=1;t<=10;t++){let o=r-900*t,i=`${e}-updown-15m-${o}`,a=I.get(i);a&&"pending"!==a.result||n.push((async()=>{try{let e=await m(i),t=new Date((o+900)*1e3);I.set(i,{slug:i,timestamp:o,result:e,endTime:t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})}catch{}})())}}await Promise.all(n)}async function m(e){try{let t=await d("/markets",{slug:e},2);if(!t?.[0])return"pending";let r=t[0];if(!0===r.active&&!r.closed)return"pending";if(r.outcomePrices)try{let e;if("string"==typeof r.outcomePrices)try{let t=JSON.parse(r.outcomePrices);e=Array.isArray(t)?t.map(Number):r.outcomePrices.split(",").map(Number)}catch{e=r.outcomePrices.split(",").map(Number)}else e=Array.isArray(r.outcomePrices)?r.outcomePrices.map(Number):[];if(e.length>=2&&!e.some(isNaN)){if(e[0]>e[1])return"up";if(e[1]>e[0])return"down"}}catch{}let n=r.clobTokenIds?"string"==typeof r.clobTokenIds?JSON.parse(r.clobTokenIds):r.clobTokenIds:[];if(n.length>=2)try{let e=(0,a.YX)(),t=await e.getMidpoints([{token_id:n[0],side:c.Side.BUY},{token_id:n[1],side:c.Side.BUY}]),r=parseFloat(t?.[n[0]]||"0"),o=parseFloat(t?.[n[1]]||"0");if(r>.9)return"up";if(o>.9)return"down"}catch{}return"pending"}catch{return"pending"}}function E(e){let t=Math.floor(Date.now()/1e3),r=900*Math.floor(t/900),n=[],o=e&&e.length>0?e.map(e=>y[e]):Object.values(y);for(let e=1;e<=10;e++){let t=r-900*e;for(let e of o){let r=`${e}-updown-15m-${t}`,o=I.get(r);if(o){n.push(o);break}}}return n}function C(e){S(e).catch(e=>{s.k.error(`[Scanner] Initial scan failed: ${e}`)}),setInterval(()=>{S(e).catch(e=>{s.k.error(`[Scanner] Scan failed: ${e}`)})},3e4),setInterval(()=>{f(e).catch(e=>{s.k.error(`[Scanner] Price poll failed: ${e}`)})},2e3),s.k.info(`[Scanner] Started for assets: ${e.join(", ")}`)}function k(e,t){let r=I.get(e);if(r)r.result=t;else{let r=parseInt(e.split("-").pop()||"0",10),n=new Date((r+900)*1e3);I.set(e,{slug:e,timestamp:r,result:t,endTime:n.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})}}function g(){let e=Math.floor(Date.now()/1e3);return Array.from(w.values()).map(t=>{let r=parseInt(t.slug.split("-").pop()||"0",10);return{...t,secondsRemaining:Math.max(0,r+900-e)}})}function h(e){return w.get(e)||null}n()}catch(e){n(e)}})}};